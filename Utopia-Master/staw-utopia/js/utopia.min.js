var module;function wrapInterceptors(t,a,r){a=a.type?"["+a.type+"] "+a.name:a;(t instanceof Function||!t.length)&&(t=[t]),$.each(t,function(t,e){e instanceof Function?r.push({fn:e,priority:50,source:a}):e.fn?(e.priority=e.priority||50,e.source=e.source||a,r.push(e)):console.log("Invalid interceptor",e)})}(module=angular.module("utopia-dragdrop",[])).directive("draggable",function(){return{scope:{dragItem:"=",dragStore:"=",dragSource:"="},link:function(e,a){a.prop("draggable",!0),a.on("dragstart",function(t){e.$apply(function(){e.dragStore.item=e.dragItem,e.dragStore.source=e.dragSource}),a.addClass("dragging"),t.originalEvent.dataTransfer.effectAllowed="move",t.originalEvent.dataTransfer.setData("text/plain","google")}),a.on("dragend",function(t){a.removeClass("dragging"),e.$apply(function(t){delete t.dragStore.item,delete t.dragStore.source})}),a.on("click",function(t){return e.$apply(function(){e.dragStore.item!=e.dragItem?(e.dragStore.item=e.dragItem,e.dragStore.source=e.dragSource):delete e.dragStore.item}),t.preventDefault(),!1})}}}),module.directive("droppable",function(){return{scope:{drop:"&",canDrop:"&",dragStore:"="},link:function(e,a){a.on("dragover",function(t){e.canDrop({$item:e.dragStore.item})&&(a.addClass("drag-over"),t.preventDefault())}),a.on("dragenter",function(t){e.canDrop({$item:e.dragStore.item})&&a.addClass("drag-over")}),a.on("dragleave",function(t){a.removeClass("drag-over")}),a.on("drop",function(t){a.removeClass("drag-over"),e.$apply(function(t){t.drop({$item:t.dragStore.item}),delete t.dragStore.item}),t.preventDefault()}),a.on("click",function(t){e.$apply(function(){e.dragStore.item&&(e.drop({$item:e.dragStore.item}),delete e.dragStore.item)}),t.preventDefault()})}}}),(module=angular.module("utopia-fleet-builder",["utopia-card-upgrade","utopia-dragdrop"])).directive("fleetBuilder",["$filter",function(c){return{scope:{fleet:"=",cards:"=",searchOptions:"=",dragStore:"="},templateUrl:"fleet-builder.html",controller:["$scope","isMobile",function(l,t){l.isMobile=t,l.$watch("fleet",function(t){location.hash=btoa(angular.toJson(l.saveFleet(t)))},!0),l.$on("removeFromFleet",function(t,e){l.removeFromFleet(e,l.fleet)}),l.$on("zoom",function(t,e){l.zoom=e}),l.setSearchTypes=function(a){$.each(l.searchOptions.types,function(t,e){e.search=0<=$.inArray(t,a)}),l.searchOptions.columns<1&&(l.searchOptions.columns=1)},l.addFleetShip=function(t,e){var a=l.findOtherInFleet(e,t);return i(e,"canJoinFleet",e,t)?a&&a!=e?(console.log("upgrade uniquenes check failed"),!1):(a&&l.removeFromFleet(a,t),e=angular.copy(e),t.ships.push(e),e):(console.log("joinFleet stopped by interceptor"),!1)},l.getUpgradeSlots=c("upgradeSlots"),l.isUpgradeCompatible=function(t,e,a,r){if(t==e.occupant)return!1;var s=i(e,"type",a,r);return"question"==t.type?t.isSlotCompatible&&t.isSlotCompatible(s):0<=$.inArray(t.type,s)};var i=c("valueOf");function s(t,e){return!!(e&&t.unique&&e.unique&&t.name==e.name&&t.mirror==e.mirror)&&e}function n(t){if(!t)return{};var e={id:t.type+":"+t.id};t.resource&&(e.resource=n(t.resource)),t.captain&&(e.captain=n(t.captain)),t.admiral&&(e.admiral=n(t.admiral));var r=[];$.each(t.upgrades||[],function(t,e){var a={};e.occupant&&(a=n(e.occupant)),r.push(a)}),0<r.length&&(e.upgrades=r);var s=[];return $.each(t.upgradeSlots||[],function(t,e){var a={};e.occupant&&(a=n(e.occupant)),s.push(a)}),0<s.length&&(e.upgradeSlots=s),e}function d(n,i,c,o){var t=angular.copy(l.findCardById(i,c.id));if(!t)return console.log("unable to load card",c.id),!1;return{card:t,promulgate:function(s){var t;if(c.resource&&(t=d(n,i,c.resource,s))){var e=l.setShipResource(n,s,t.card);e&&t.promulgate(e)}if(c.captain&&(t=d(n,i,c.captain,s))){var a=l.setShipCaptain(n,s,t.card);a&&t.promulgate(a)}if(c.admiral&&(t=d(n,i,c.admiral,s))){var r=l.setShipAdmiral(n,s,t.card);r&&t.promulgate(r)}$.each(c.upgrades||[],function(t,e){if(e&&e.id){var a=d(n,i,e,s);if(!a)return;var r=l.setUpgrade(n,s,s.upgrades[t],a.card);if(!r)return;a.promulgate(r)}}),$.each(c.upgradeSlots||[],function(t,e){if(e&&e.id){var a=d(n,i,e,o||s);if(!a)return;var r=l.setUpgrade(n,o||s,s.upgradeSlots[t],a.card);if(!r)return;a.promulgate(r)}})}}}l.setUpgrade=function(t,e,a,r){if(!l.isUpgradeCompatible(r,a,e,t))return console.log("wrong slot type"),!1;if(a.occupant==r)return!1;if(!i(r,"canEquip",e,t,a))return console.log("equip stopped by special card rule"),!1;if(!i(r,"canEquipFaction",e,t,a))return console.log("equip stopped by faction-specific special card rule"),!1;if(a.canEquip&&!a.canEquip(r,e,t,a))return console.log("upgrade rejected by slot"),!1;var s=l.findOtherInFleet(r,t);return s&&s!=r&&s!=a.occupant?(console.log("upgrade uniquenes check failed"),!1):(s&&s!=a.occupant&&l.removeFromFleet(s,t,a.occupant),a.occupant=angular.copy(r),i(a.occupant,"onEquip",e,t),a.occupant)},l.setShipResource=function(t,e,a){if(!t.resource||a.type!=t.resource.slotType)return!1;if(!i(a,"canEquip",e,t))return console.log("equip stopped by special card rule"),!1;var r=l.findOtherInFleet(a,t);return r&&r!=upgrade&&r!=e.resource?(console.log("upgrade uniquenes check failed"),!1):(e.resource=angular.copy(a),e.resource)},l.setShipCaptain=function(t,e,a){if("captain"!=a.type)return console.log("card is not a captain"),!1;if(!i(a,"canEquipCaptain",e,t))return console.log("equip stopped by interceptor"),!1;var r=l.findOtherInFleet(a,t);return r&&r!=a&&r!=e.captain?(console.log("captain already in fleet"),!1):(r&&r!=e.captain&&l.removeFromFleet(r,t,e.captain),e.captain=angular.copy(a),e.captain)},l.fleetHasAdmiral=function(t){var a=!1;return $.each(t.ships,function(t,e){if(e.admiral)return!(a=!0)}),a},l.setShipAdmiral=function(t,e,a){if("admiral"!=a.type)return!1;if(!i(a,"canEquipAdmiral",e,t))return console.log("equip stopped by interceptor"),!1;var r=l.findOtherInFleet(a,t);return r&&r!=a&&r!=e.admiral?(console.log("admiral already in fleet"),!1):(r&&r!=e.admiral&&l.removeFromFleet(r,t,e.admiral),e.admiral=angular.copy(a),e.admiral)},l.findOtherInFleet=function(a,t){var r=!1;return $.each(t.ships,function(t,e){return a==e||s(a,e)?(r=e,!1):a==e.captain||s(a,e.captain)?(r=e.captain,!1):a==e.admiral||s(a,e.admiral)?(r=e.admiral,!1):($.each(l.getUpgradeSlots(e),function(t,e){if(a==e.occupant||s(a,e.occupant))return r=e.occupant,!1}),!r&&void 0)}),t.resource&&$.each(t.resource.upgradeSlots||[],function(t,e){if(a==e.occupant||s(a,e.occupant))return r=e.occupant,!1}),r},l.removeFromFleet=function(r,s,n){if(!r)return!1;r==s.resource&&delete s.resource,s.resource&&$.each(s.resource.upgradeSlots||[],function(t,e){if(r==e.occupant)return n&&l.isUpgradeCompatible(n,e)?e.occupant=n:delete e.occupant,!(found=!0)}),$.each(s.ships,function(t,e){if(r==e)return n&&"ship"==n.type?s.ships[t]=n:s.ships.splice(t,1),!1;if(r==e.resource)return delete e.resource,!1;if(r==e.captain)return n&&"captain"==n.type?e.captain=n:delete e.captain,!1;if(r==e.admiral)return n&&"admiral"==n.type?e.admiral=n:delete e.admiral,!1;var a=!1;return $.each(l.getUpgradeSlots(e),function(t,e){if(r==e.occupant)return n&&l.isUpgradeCompatible(n,e)?e.occupant=n:delete e.occupant,!(a=!0)}),!a}),i(r,"onRemove",{},s)},l.getTotalCost=function(a,r){var s=c("valueOf"),n=s(a,"cost",a,r);return a.resource&&(s(a.resource,"free",a,r)||(n+=s(a.resource,"cost",a,r))),a.captain&&(s(a.captain,"free",a,r)||(n+=s(a.captain,"cost",a,r))),a.admiral&&(s(a.admiral,"free",a,r)||(n+=s(a.admiral,"cost",a,r))),$.each(l.getUpgradeSlots(a),function(t,e){e.occupant&&(s(e.occupant,"free",a,r)||(n+=s(e.occupant,"cost",a,r)))}),a.totalCost=n},l.getFleetCost=function(a){var r=a.resource?i(a.resource,"cost",{},a):0;return $.each(a.ships,function(t,e){r+=l.getTotalCost(e,a)}),a.totalCost=r},l.setFleetResource=function(t,e){t.resource&&l.removeFromFleet(t.resource,t),t.resource=e},l.saveFleet=function(t){var a={ships:[]};return t.resource&&(a.resource=n(t.resource)),$.each(t.ships,function(t,e){a.ships.push(n(e))}),a},l.findCardById=function(t,a){var r=!1;return $.each(t,function(t,e){if(e.type+":"+e.id==a)return r=e,!1}),r};var e=!(l.loadFleet=function(s,t){var n={ships:[]};return t.resource&&(result=d(n,s,t.resource),result&&(n.resource=result.card,result.promulgate(n.resource))),$.each(t.ships,function(t,e){var a=d(n,s,e);if(a){var r=l.addFleetShip(n,a.card);r&&a.promulgate(r)}}),n});try{e=!!location.hash&&angular.fromJson(atob(location.hash.substring(1)))}catch(t){}l.$on("cardsLoaded",function(){e&&(e=l.loadFleet(l.cards,e))&&(l.fleet=e,0<l.fleet.ships.length&&($.each(e.ships,function(t,e){e.hideEmptySlots=!0}),l.searchOptions.columns=0))})}]}}]),(module=angular.module("utopia-fleet-export",[])).directive("fleetExport",function(){return{scope:{fleet:"=",sets:"=",searchOptions:"="},templateUrl:"fleet-export.html",link:function(t,e){$(e).find("textarea").focus(function(){$this=$(this),$this.select(),window.setTimeout(function(){$this.select()},1),$this.mouseup(function(){return $this.unbind("mouseup"),!1})})},controller:["$scope","$filter",function(f,t){f.fleetText="",f.showSetNames=!1,f.ttsExportStyle=!1;var h=t("valueOf");function e(r){if("fleetSheet"==f.exportType)!function(r){var s={cost:r.totalCost,ships:[],resource:{}};$.each(r.ships,function(t,e){var a=[];!function a(t,r,s,n){var e,i,c,o,l={name:t.name,type:(o=t.type,{ship:"Ship",captain:"Captain",admiral:"Admiral",crew:"C",talent:"E",tech:"T",weapon:"W",borg:"B",squadron:"S"}[o]),faction:(e=t.factions,i={federation:"FED",klingon:"KLI",romulan:"ROM",dominion:"DOM",borg:"BOR","species-8472":"SPE",kazon:"KAZ",xindi:"XIN",bajoran:"BAJ",ferengi:"FER",vulcan:"VUL",independent:"IND","mirror-universe":"MIR","q-continuum":"Q"},c=[],$.each(e,function(t,e){e in i?c.push(i[e]):console.error("Unknown Faction: "+e)}),c.join("/")),cost:h(t,"cost",r,s),priority:0};switch("ship"!=t.type||t.unique||(l.name="Generic "+t.class),l.type){case"Ship":l.priority=0;break;case"Captain":l.priority=1;break;case"Admiral":l.priority=2;break;default:l.priority=3}n.push(l),t.resource&&n.push(a(t.resource,r,s,n)),t.captain&&n.push(a(t.captain,r,s,n)),t.admiral&&n.push(a(t.admiral,r,s,n)),t.upgrades&&0<t.upgrades.length&&$.each(t.upgrades,function(t,e){e.occupant&&n.push(a(e.occupant,r,s,n))}),t.upgradeSlots&&0<t.upgradeSlots.length&&$.each(t.upgradeSlots||[],function(t,e){e.occupant&&n.push(a(e.occupant,r,s,n))})}(e,e,r,a),(a=$.grep(a,function(t){return 0==t||t})).sort(function(t,e){return t.priority-e.priority}),$.each(a,function(t,e){delete e.priority,e.index=t}),s.ships.push({cards:a.slice(),cost:e.totalCost})}),r.resource&&(s.resource.name=r.resource.name,s.resource.cost=h(r.resource,"cost",{},r));s.ships.sort(function(t,e){return e.cost-t.cost}),f.fleetText=JSON.stringify(s,null,2)}(r);else if("tts"==f.exportType)!function(r){var s="";if($.each(r.ships,function(t,e){var a=i(e,e,r);s+=a.text+"\n"}),r.resource){var t=i(r.resource,{},r);s+=t.text+"\n"}if(s+="------------------------------------------\n",$.each(r.ships,function(t,e){var a=c(e,e,r);s+=a.text+"\n"}),r.resource){var e=c(r.resource,{},r);s+=e.text+"\n"}s+="------------------------------------------\n",s+="Generated by Utopia for Tabletop Simulator",f.fleetText=s}(r);else{var s="",n=0;if(s+="Save your URL for easy Reloading\n\n",$.each(r.ships,function(t,e){var a=g(e,e,r);s+=a.text+"Ship Total: "+a.cost+" SP\n\n",n+=a.cost}),r.resource){var t=g(r.resource,{},r);s+="Resource: "+t.text+"\n",n+=t.cost}s+="Fleet Total: "+n+" SP\n\n",s+="Generated by Utopia\nhttp://kfnexus.github.io/staw-utopia/",f.fleetText=s}}function g(t,r,s,n,e){var i="";n=n||0;for(var a=0;a<n;a++)i+="- ";var c,o,l=h(t,"cost",r,s),d=h(t,"free",r,s),p=!0;if("resource"==t.type&&(p=!1),i+=t.name,"captain"==t.type&&(i+=" "+t.skill+" (Captain)"),"admiral"==t.type&&(i+=" (Admiral)"),"fleet-captain"==t.type&&(i+=" Fleet Captain"),"flagship"==t.type&&(i+=" Flagship"),"faction"==t.type&&(i+=" Faction"),"ship"==t.type?i+=t.unique?"":" ("+t.class+")":f.showSetNames&&(i+=t.set?" ("+(c=t.set,o="",$.each(c,function(t,e){o+=f.sets[e]?f.sets[e].name:e,t<c.length-1&&(o+=", ")}),o)+")":""),d&&(l=0),e||(i+=" ["+l+"]"),i+="\n",t.resource){var u=g(t.resource,r,s,n+1);i+=u.text,l+=u.cost}if(t.captain){u=g(t.captain,r,s,n+1);i+=u.text,l+=u.cost}if(t.admiral){u=g(t.admiral,r,s,n+1);i+=u.text,l+=u.cost}return $.each(t.upgrades||[],function(t,e){if(e.occupant){var a=g(e.occupant,r,s,n+1);i+=a.text,p&&(l+=a.cost)}}),$.each(t.upgradeSlots||[],function(t,e){if(e.occupant){var a=g(e.occupant,r,s,n+1,!p);i+=a.text,p&&(l+=a.cost)}}),{cost:l,text:i}}function i(t,r,s){var n="";if(n="ship"!=t.type||t.unique?t.name:t.class,n+="\n",t.resource){var e=i(t.resource,r,s);n+=e.text}if(t.captain){e=i(t.captain,r,s);n+=e.text}if(t.admiral){e=i(t.admiral,r,s);n+=e.text}return $.each(t.upgrades||[],function(t,e){if(e.occupant){var a=i(e.occupant,r,s);n+=a.text}}),$.each(t.upgradeSlots||[],function(t,e){if(e.occupant){var a=i(e.occupant,r,s);n+=a.text}}),{cost:0,text:n}}function c(t,r,s){var n="";if(n=("ship"!=t.type||t.unique,t.id),n+="\n",t.resource){var e=c(t.resource,r,s);n+=e.text}if(t.captain){e=c(t.captain,r,s);n+=e.text}if(t.admiral){e=c(t.admiral,r,s);n+=e.text}return $.each(t.upgrades||[],function(t,e){if(e.occupant){var a=c(e.occupant,r,s);n+=a.text}}),$.each(t.upgradeSlots||[],function(t,e){if(e.occupant){var a=c(e.occupant,r,s);n+=a.text}}),{cost:0,text:n}}f.$watch("fleet",function(t){e(t)},!0),f.$watch("showSetNames",function(){e(f.fleet)}),f.$watch("exportType",function(){e(f.fleet)})}]}}),(module=angular.module("utopia-fleet-export",[])).directive("fleetExport",function(){return{scope:{fleet:"=",sets:"=",searchOptions:"="},templateUrl:"fleet-export.html",link:function(t,e){$(e).find("textarea").focus(function(){$this=$(this),$this.select(),window.setTimeout(function(){$this.select()},1),$this.mouseup(function(){return $this.unbind("mouseup"),!1})})},controller:["$scope","$filter",function(f,t){f.fleetText="",f.showSetNames=!1,f.ttsExportStyle=!1;var h=t("valueOf");function e(r){var s="",n=0;if($.each(r.ships,function(t,e){var a=g(e,e,r);s+=a.text+"Ship Total: "+a.cost+" SP\n\n",n+=a.cost}),r.resource){var t=g(r.resource,{},r);s+="Resource: "+t.text+"\n",n+=t.cost}s+="Fleet Total: "+n+" SP\n\n",s+="Generated by Utopia\nhttp://kfnexus.github.io/staw-utopia/",f.fleetText=s}function g(t,r,s,n,e){var i="";n=n||0;for(var a=0;a<n;a++)i+="- ";var c,o,l=h(t,"cost",r,s),d=h(t,"free",r,s),p=!0;if("resource"==t.type&&(p=!1),i+=t.name,"captain"==t.type?i+=" "+t.skill+" (Captain)":f.ttsExportStyle,"admiral"==t.type&&(i+=" (Admiral)"),"fleet-captain"==t.type&&(i+=" Fleet Captain"),"flagship"==t.type&&(i+=" Flagship"),"faction"==t.type&&(i+=" Faction"),"ship"==t.type?i+=t.unique?"":" ("+t.class+")":f.showSetNames?i+=t.set?" ("+(c=t.set,o="",$.each(c,function(t,e){o+=f.sets[e]?f.sets[e].name:e,t<c.length-1&&(o+=", ")}),o)+")":"":f.ttsExportStyle&&t.name,d&&(l=0),e||(i+=" ["+l+"]"),i+="\n",t.resource){var u=g(t.resource,r,s,n+1);i+=u.text,l+=u.cost}if(t.captain){u=g(t.captain,r,s,n+1);i+=u.text,l+=u.cost}if(t.admiral){u=g(t.admiral,r,s,n+1);i+=u.text,l+=u.cost}return $.each(t.upgrades||[],function(t,e){if(e.occupant){var a=g(e.occupant,r,s,n+1);i+=a.text,p&&(l+=a.cost)}}),$.each(t.upgradeSlots||[],function(t,e){if(e.occupant){var a=g(e.occupant,r,s,n+1,!p);i+=a.text,p&&(l+=a.cost)}}),{cost:l,text:i}}f.$watch("fleet",function(t){e(t)},!0),f.$watch("showSetNames",function(){e(f.fleet)}),f.$watch("ttsExportStyle",function(){e(f.fleet)})}]}}),(module=angular.module("utopia-missions",["utopia"])).controller("UtopiaSetCtrl",["$scope","cardLoader",function(r,t){r.missionSets={},r.missionList=[],r.viewer={},r.activeSet=!1,r.setCards=[],t(r.missionSets,function(){!!location.hash&&location.hash.substring(1);$.each(Object.keys(r.missionSets),function(t,e){var a=r.missionSets[e];a.sourceID!=e&&a.name!=e||(r.viewer.missionSets=a,r.missionList.push(a))}),r.$watch("viewer.missionSets",function(a){r.missionSetCards=[],a&&(location.hash=a.sourceID,$.each(r.cards,function(t,e){0<=$.inArray(a.sourceID,e.missionSet)&&r.setCards.push(e)}),r.setCards.sort(displaySort))})})}]),(module=angular.module("utopia-search",["utopia-card","utopia-dragdrop","utopia-card-loader","utopia-card-rules"])).filter("cardFilter",["$factions","$filter",function(l,a){return function(t,o){var e=a("valueOf");return $.map(t,function(r){if(o.unique&&!r.unique&&!o.generic)return null;if(o.generic&&r.unique&&!o.unique)return null;if(r.set&&!o.ignoreSetsFilter&&o.sets){var a=!1;if($.each(r.set,function(t,e){o.sets[e].search&&(a=!0)}),!a)return null}if(o.filterField&&o.filterOperator&&o.filterValue){var t=e(r,o.filterField);if(!t)return null;switch(o.filterOperator){case"<":if(t>=o.filterValue)return null;break;case"<=":if(t>o.filterValue)return null;break;case"=":if(t!=o.filterValue)return null;break;case">=":if(t<o.filterValue)return null;break;case">":if(t<=o.filterValue)return null}}if(o.query&&r.name.toLowerCase().indexOf(o.query.toLowerCase())<0&&(!r.class||r.class.toLowerCase().indexOf(o.query.toLowerCase())<0)&&r.text.toLowerCase().indexOf(o.query.toLowerCase())<0)return null;var s=!0;if($.each(o.types,function(t,e){if(e.search)return s=!1}),!s&&!o.types[r.type].search)return null;if(o.maneuverType){if("ship"!=r.type)return null;var n=!1,i=[];if($.each(Object.keys(r.classData.maneuvers),function(t,a){if($.isNumeric(a)){var e=Object.keys(r.classData.maneuvers[a]);$.each(e,function(t,e){maneuver_object={},maneuver_object.direction=e,maneuver_object.difficulty=r.classData.maneuvers[a][e],maneuver_object.speed=parseInt(a,10),maneuver_object.speed<0&&(maneuver_object.direction="reverse",maneuver_object.speed=Math.abs(maneuver_object.speed)),i.push(maneuver_object)})}}),$.each(i,function(t,e){o.maneuverDifficulty?e.direction==o.maneuverType&&e.difficulty==o.maneuverDifficulty&&(n=!0):e.direction==o.maneuverType&&(n=!0)}),!n)return null}if("resource"==r.type)return r;s=!0;var c=!1;return $.each(o.factions,function(t,e){e.search&&(s=!1,c|=l.hasFaction(r,t))}),s||c?r:null})}}]),module.filter("sortBy",["$filter",function(r){return function(t,e,a){return a=!0===a||"true"==a,r("orderBy")(t,function(t){return r("valueOf")(t,e)||0},!a)}}]),module.directive("search",function(){return{scope:{cards:"=",sets:"=",setList:"=",dragStore:"=",search:"=searchOptions",defaults:"="},templateUrl:"search.html",controller:["$scope","$factions",function(s,t){s.search={query:"",unique:!1,generic:!1,factions:{},types:{ship:{},captain:{},admiral:{}},columns:1,sortBy:"cost",ascending:"false",maneuverType:"",maneuverDifficulty:"",filterField:"",filterOperator:"<=",filterValue:""},s.defaults=localStorage.defaults?angular.fromJson(localStorage.defaults):{},s.defaults.search?angular.copy(s.defaults.search,s.search):s.defaults.search=angular.copy(s.search),s.resetSearch=function(){s.search.query="",s.search.unique=!1,s.search.generic=!1,$.each(s.search.factions,function(t,e){e.search=!1}),$.each(s.search.types,function(t,e){e.search=!1}),s.search.sortBy=s.defaults.search.sortBy||"name",s.search.ascending=s.defaults.search.ascending||"true",s.search.maneuverType="",s.search.maneuverDifficulty="",s.search.filterField="",s.search.filterOperator="<=",s.search.filterValue=""},s.modifySearchColumns=function(t){s.search.columns+=t,s.search.columns<0&&(s.search.columns=0),5<s.search.columns&&(s.search.columns=5)},s.$watch("search",function(){s.resultLimit=10},!0),s.$watch("search.sets",function(t){t&&(localStorage.sets=angular.toJson(t))},!0),s.$watch("defaults",function(t){t&&(localStorage.defaults=angular.toJson(t))},!0),$.each(t.list,function(t,e){s.search.factions[e.toLowerCase().replace(/ /g,"-")]={}}),s.sortables=[{value:"name",name:"Name"},{value:"cost",name:"Cost"},{value:"attack",name:"Attack"},{value:"agility",name:"Agility"},{value:"hull",name:"Hull"},{value:"shields",name:"Shields"},{value:"skill",name:"Skill Value"}],s.maneuvers=[{value:"bank",name:"Bank"},{value:"turn",name:"Turn"},{value:"about",name:"Come About"},{value:"reverse",name:"Full Astern"},{value:"spin",name:"Spin"},{value:"stop",name:"Stop"},{value:"flank",name:"Flank"},{value:"45-degree-rotate",name:"Rotate 45 Degrees"},{value:"90-degree-rotate",name:"Rotate 90 Degrees"}],s.difficulty_list=[{value:"green",name:"Green"},{value:"white",name:"White"},{value:"red",name:"Red"}],s.$on("cardsLoaded",function(){$.each(s.cards,function(t,e){s.search.types[e.type]||(s.search.types[e.type]={})});try{s.search.sets=localStorage.sets?angular.fromJson(localStorage.sets):{},s.defaults=localStorage.defaults?angular.fromJson(localStorage.defaults):{}}catch(t){s.search.sets={},s.defaults={}}$.each(s.sets,function(t,e){s.search.sets[e.id]||(console.log("New set: "+e.name),s.search.sets[e.id]={search:!0}),s.setList.push(e)})}),s.uncheckAllSets=function(){$.each(s.search.sets,function(t,e){e.search=!1})},s.exportSets=function(){var t="utopia_owned_sets.json",e=JSON.stringify(s.search.sets,null,2),a=encodeURIComponent(e),r=document.createElement("a");console.log("Exporting owned sets to the file "+t),r.setAttribute("href","data:application/json;charset=utf-8,"+a),r.setAttribute("download",t),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)},s.importSets=function(t){var e=t.files[0],a=new FileReader,r="";a.onload=function(t){r=t.target.result,s.processSetsImport(r)},console.info("Opening "+e.name+" saved set file..."),a.readAsText(e)},s.processSetsImport=function(t){var e=JSON.parse(t),a=0;$.each(e,function(t,e){"search"in e==0&&a++}),0<a?console.error("Owned set file import failed with "+a+" errors found in file."):(localStorage.sets=angular.toJson(e),window.location.reload(!0))},s.checkAllSets=function(){$.each(s.search.sets,function(t,e){e.search=!0})}}]}}),module.directive("searchFilterGroup",function(){return{scope:{title:"@"},templateUrl:"search-filter-group.html",transclude:!0,link:function(t,e,a){null!=a.open&&(t.showContent=!0)}}}),(module=angular.module("utopia-set-viewer",["utopia"])).controller("UtopiaSetCtrl",["$scope","$filter","cardLoader","$factions",function(s,t,e,a){function r(t,e){return"ship"==t.type&&t.unique?-1:"ship"==e.type&&e.unique?1:t.type==e.type?(r=e,(a=t).cost>r.cost?-1:r.cost>a.cost?1:0):"ship"==t.type?-1:"ship"==e.type?1:"captain"==t.type?-1:"captain"==e.type?1:"admiral"==t.type?-1:"admiral"==e.type?1:"talent"==t.type?-1:"talent"==e.type?1:"crew"==t.type?-1:"crew"==e.type?1:"weapon"==t.type?-1:"weapon"==e.type?1:"tech"==t.type?-1:"tech"==e.type?1:0;var a,r}s.cards=[],s.sets={},s.setList=[],s.shipClasses={},s.token={},s.viewer={},s.activeSet=!1,s.setCards=[],e(s.cards,s.sets,s.shipClasses,s.token,function(){var r=!!location.hash&&location.hash.substring(1);$.each(Object.keys(s.sets),function(t,e){var a=s.sets[e];a.id!=r&&a.name!=r||(s.viewer.set=a),s.setList.push(a)})}),s.$watch("viewer.set",function(a){s.setCards=[],a&&(location.hash=a.id,$.each(s.cards,function(t,e){0<=$.inArray(a.id,e.set)&&s.setCards.push(e)}),s.setCards.sort(r))})}]),(module=angular.module("utopia-tooltip",[])).directive("tooltip",["$filter",function(n){return{scope:{tooltip:"&",tooltipPosition:"@",tooltipShow:"="},restrict:"A",link:function(e,a,t){var s=!1;e.$watch("tooltipShow",function(t){if(t&&!s){s=!0,$(a).data("powertipjq",$("<div></div>")),$(a).powerTip({placement:e.tooltipPosition||"ne-alt"});var r=n("icons");$(a).on("powerTipRender",function(){var a=$("<table class='card-tooltip'></table>");$.each(e.tooltip(),function(t,e){a.append("<tr><td>"+r(e.source)+"</td><td>"+(0<e.value&&0<t?"+":"")+e.value+"</tr>")}),$("#powerTip").html(a)}),e.$on("$destroy",function(){$(a).powerTip("destroy")})}})}}}]),(module=angular.module("utopia-tts-export",[])).directive("tabeltopSimExport",function(){return console.log("Reporting for duty."),{scope:{fleet:"=",sets:"=",searchOptions:"="},templateUrl:"fleet-export.html",link:function(t,e){$(e).find("textarea").focus(function(){$this=$(this),$this.select(),window.setTimeout(function(){$this.select()},1),$this.mouseup(function(){return $this.unbind("mouseup"),!1})})},controller:["$scope","$filter",function(f,t){f.ttsText="",f.showSetNames=!1;var h=t("valueOf");function e(r){var s="";if($.each(r.ships,function(t,e){var a=g(e,e,r);s+=a.text+"Ship Total: "+a.cost+" SP\n\n",a.cost}),r.resource){var t=g(r.resource,{},r);s+="Resource: "+t.text+"\n",t.cost}s+="Load into Tabletop Simulator\nhttp://steamcommunity.com/sharedfiles/filedetails/?id=645363597",f.ttsText=s}function g(t,r,s,n,e){var i="";n=n||0;for(var a=0;a<n;a++)i+="- ";var c,o,l=h(t,"cost",r,s),d=h(t,"free",r,s),p=!0;if("resource"==t.type&&(p=!1),i+=t.name,"captain"==t.type&&(i+=" "+t.skill+" (Captain)"),"admiral"==t.type&&(i+=" (Admiral)"),"fleet-captain"==t.type&&(i+=" Fleet Captain"),"flagship"==t.type&&(i+=" Flagship"),"faction"==t.type&&(i+=" Faction"),"ship"==t.type?i+=t.unique?"":" ("+t.class+")":f.showSetNames&&(i+=t.set?" ("+(c=t.set,o="",$.each(c,function(t,e){o+=f.sets[e]?f.sets[e].name:e,t<c.length-1&&(o+=", ")}),o)+")":""),d&&(l=0),e||(i+=" ["+l+"]"),i+="\n",t.resource){var u=g(t.resource,r,s,n+1);i+=u.text,l+=u.cost}if(t.captain){u=g(t.captain,r,s,n+1);i+=u.text,l+=u.cost}if(t.admiral){u=g(t.admiral,r,s,n+1);i+=u.text,l+=u.cost}return $.each(t.upgrades||[],function(t,e){if(e.occupant){var a=g(e.occupant,r,s,n+1);i+=a.text,p&&(l+=a.cost)}}),$.each(t.upgradeSlots||[],function(t,e){if(e.occupant){var a=g(e.occupant,r,s,n+1,!p);i+=a.text,p&&(l+=a.cost)}}),{cost:l,text:i}}f.$watch("fleet",function(t){e(t)},!0),f.$watch("showSetNames",function(){e(f.fleet)})}]}}),(module=angular.module("utopia",["ngSanitize","utopia-search","utopia-card","utopia-fleet-builder","utopia-fleet-export","utopia-card-loader","utopia-card-rules"])).factory("isMobile",function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}),module.controller("UtopiaCtrl",["$scope","$filter","cardLoader","$factions",function(a,t,e,r){a.defaults={};try{a.defaults=!!localStorage.defaults&&angular.fromJson(localStorage.defaults)}catch(t){a.defaults={}}a.drag={},a.cards=[],a.sets={},a.setList=[],a.shipClasses={},a.token={},a.activeFleet={ships:[]},a.loading=!0,e(a.cards,a.sets,a.shipClasses,a.token,function(){a.$broadcast("cardsLoaded"),a.loading=!1}),a.$watch("defaults",function(t){t&&(localStorage.defaults=angular.toJson(t))},!0),a.$on("removeFromFleetDropped",function(t,e){a.$broadcast("removeFromFleet",e)}),a.keypress=function(t){(26==t.which||122==t.which&&t.ctrlKey)&&(a.zoom=!a.zoom,a.$broadcast("zoom",a.zoom))}}]),(module=angular.module("utopia-card-faction",[])).directive("cardFaction",function(){return{scope:{faction:"=",dragStore:"=",dragSource:"="},templateUrl:"card-faction.html",controller:["$scope",function(t){}]}}),(module=angular.module("utopia-card-loader",["utopia-card-rules","utopia-card-ship","utopia-card-upgrade","utopia-card-resource","utopia-card-faction","utopia-card-token"])).factory("cardLoader",["$http","$filter","cardRules","$factions",function(t,h,g,v){var m=h("valueOf");return function(i,s,n,c,a){function o(a,t){var r=!1;return $.each(t,function(t,e){if(a.id==e.id&&a.type==e.type)return!(r=!0)}),r}var l={canJoinFleet:!0,intercept:{ship:{},fleet:{}}};var d={intercept:{ship:{},fleet:{}},canEquip:!0,canEquipCaptain:!0,canEquipFaction:!0,showType:!0};var p={intercept:{ship:{},fleet:{}},canEquip:!0,canEquipAdmiral:!0,canEquipFaction:!0,isSkillModifier:!0,showType:!0};var u={intercept:{ship:{},fleet:{}},canEquip:!0,canEquipFaction:!0};var f={intercept:{ship:{},fleet:{}},canEquip:!0,canEquipFaction:!0};t.get("data/data.json").success(function(t){var e,r=[];$.each(t.sets||[],function(t,e){var a;"copy"==e.type?r.push(e):s[(a=e).id]?console.log("Duplicate set",a.id,a.name):s[a.id]=a}),$.each(t.ships||[],function(t,e){"copy"==e.type?r.push(e):function(a){if(o(a,i))console.log("Duplicate card definition ignored",a.id);else{a.mirror=v.hasFaction(a,"mirror-universe");for(var t=0;t<a.upgrades.length;t++)"string"==typeof a.upgrades[t]&&(a.upgrades[t]={type:[a.upgrades[t]],source:"ship"});$.extend(!0,a,l),a.squadron&&(a.canJoinFleet=function(t,e,a){var r=0,s=0;return $.each(a.ships,function(t,e){e.squadron?s++:4<=e.hull&&r++}),s<r}),g[a.type+":"+a.id]&&$.extend(!0,a,g[a.type+":"+a.id]),$.each(a.upgradeSlots||[],function(t,e){e.source||(e.source=a.name)}),a.intercept.ship.cost?a.intercept.ship.cost=[a.intercept.ship.cost]:a.intercept.ship.cost=[],a.intercept.ship.cost.push({source:"Faction Penalty",priority:1,fn:function(t,e,a,r){if(!v.match(t,e,e,a)){var s=m(t,"factionPenalty",e,a);return(r instanceof Function?r(t,e,a,0):r)+s}return r}}),i.push(a)}}(e)}),$.each(t.shipClasses||[],function(t,e){var a;"copy"==e.type?r.push(e):n[(a=e).id]?console.log("Duplicate ship class",a.id,a.name,n[a.id].name):n[a.id]=a}),$.each(t.captains||[],function(t,e){"copy"==e.type?r.push(e):function(a){if(o(a,i))console.log("Duplicate card definition ignored",a.id);else{$.extend(!0,a,d),null==a.factionPenalty&&(a.factionPenalty=1),a.mirror=v.hasFaction(a,"mirror-universe"),a.upgradeSlots=[];for(var t=0;t<a.talents;t++)a.upgradeSlots.push({type:["talent"],source:a.name});g[a.type+":"+a.id]&&$.extend(!0,a,g[a.type+":"+a.id]),$.each(a.upgradeSlots||[],function(t,e){e.source||(e.source=a.name)}),i.push(a)}}(e)}),$.each(t.admirals||[],function(t,e){"copy"==e.type?r.push(e):function(s){if(o(s,i))console.log("Duplicate card definition ignored",s.id);else{$.extend(!0,s,p),null==s.factionPenalty&&(s.factionPenalty=3),s.mirror=v.hasFaction(s,"mirror-universe"),s.upgradeSlots=[];for(var t=0;t<s.talents;t++)s.upgradeSlots.push({type:["talent"],source:s.name});s.intercept.ship.skill=function(t,e,a,r){return t==e.captain&&(r=(r instanceof Function?r(t,e,a,0):r)+s.skill),r},g[s.type+":"+s.id]&&$.extend(!0,s,g[s.type+":"+s.id]),$.each(s.upgradeSlots||[],function(t,e){e.source||(e.source=s.name)}),i.push(s)}}(e)}),$.each(t.upgrades||[],function(t,e){var a;"copy"==e.type?r.push(e):o(a=e,i)?console.log("Duplicate card definition ignored",a.id):($.extend(!0,a,u),null==a.factionPenalty&&(a.factionPenalty=1),a.mirror=v.hasFaction(a,"mirror-universe"),g[a.type+":"+a.id]&&$.extend(!0,a,g[a.type+":"+a.id]),$.each(a.upgradeSlots||[],function(t,e){e.source||(e.source=a.name)}),i.push(a))}),$.each(t.resources||[],function(t,e){var a;"copy"==e.type?r.push(e):(a=e,$.extend(!0,a,f),g[a.type+":"+a.id]&&$.extend(!0,a,g[a.type+":"+a.id]),i.push(a))}),$.each(t.others||[],function(t,e){"copy"==e.type?r.push(e):function(s){if("fleet-captain"==s.type){for(var t=0;t<s.talentAdd;t++)s.upgradeSlots.push({type:["talent"],source:"Fleet Captain",rules:"Free talent if Captain has an empty talent slot",showOnCard:!0,intercept:{ship:{cost:{priority:-1,fn:function(t,e,a,r){if(!e.captain)return r;var s=h("upgradeSlots")(e.captain),n=!1;return $.each(s,function(t,e){0<=e.type.indexOf("talent")&&!e.occupant&&(n=!0)}),n?0:r}}}}});for(t=0;t<s.techAdd;t++)s.upgradeSlots.push({type:["tech"],source:"Fleet Captain",showOnCard:!0});for(t=0;t<s.weaponAdd;t++)s.upgradeSlots.push({type:["weapon"],source:"Fleet Captain",showOnCard:!0});for(t=0;t<s.crewAdd;t++)s.upgradeSlots.push({type:["crew"],source:"Fleet Captain",showOnCard:!0});s.intercept.ship.skill=function(t,e,a,r){return t==e.captain&&(r=(r instanceof Function?r(t,e,a,0):r)+s.skill),r}}if("flagship"==s.type){var n=s;n.intercept.ship={attack:function(t,e,a,r){return t==e&&"flagship"!=e.type?(r instanceof Function?r(t,e,a,0):r)+n.attack:r},agility:function(t,e,a,r){return t==e&&"flagship"!=e.type?(r instanceof Function?r(t,e,a,0):r)+n.agility:r},hull:function(t,e,a,r){return t==e&&"flagship"!=e.type?(r instanceof Function?r(t,e,a,0):r)+n.hull:r},shields:function(t,e,a,r){return t==e&&"flagship"!=e.type?(r instanceof Function?r(t,e,a,0):r)+n.shields:r}}}if("token"==s.type){if(c[s.id])return console.log("Duplicate token",s.id,s.name);c[s.id]=s}g[s.type+":"+s.id]&&$.extend(!0,s,g[s.type+":"+s.id]),i.push(s)}(e)}),e=r,$.each(e||[],function(t,a){$.each(i,function(t,e){if(e.id==a.of)return e.set=e.set.concat(a.set),!1})}),$.each(i,function(t,a){"ship"==a.type&&(a.classId&&n[a.classId]?a.classData=n[a.classId]:$.each(n,function(t,e){if(e.name==a.class)return a.classId=t,a.classData=e,!1}),a.classId&&a.classData&&n[a.classId]||console.log("No class for ship",a.id,a.name,a.class,a.classId)),a.hasTokenInfo&&c[a.tokenId]&&(a.tokenData=c[a.tokenId])}),a&&a()})}}]),(module=angular.module("utopia-card-resource",[])).directive("cardResource",function(){return{scope:{resource:"=",ship:"=",fleet:"=",dragStore:"=",dragSource:"="},templateUrl:"card-resource.html",controller:["$scope",function(t){}]}}),(module=angular.module("utopia-card-ship-class",[])).directive("cardShipClass",function(){return{scope:{shipClass:"=",ship:"=",fleet:"="},templateUrl:"card-ship-class.html",controller:["$scope",function(t){t.abs=Math.abs,t.speeds=[];for(var e=t.shipClass.maneuvers,a=e.max;a>=e.min;a--)(0!=a||e[0])&&t.speeds.push(a);for(t.speeds.length<7&&-2<e.min&&t.speeds.push(9),t.speeds.length<7&&-1<e.min&&t.speeds.push(9);t.speeds.length<7;)t.speeds.unshift(9);t.getBaseTileName=function(t){return t.unique?t.name:t.class}}]}}),(module=angular.module("utopia-card-ship",[])).directive("cardShip",function(){return{scope:{ship:"=",fleet:"=",dragStore:"=",dragSource:"="},templateUrl:"card-ship.html",controller:["$scope",function(t){}]}}),(module=angular.module("utopia-card-token",[])).directive("cardToken",function(){return{scope:{token:"=",ship:"=",fleet:"=",dragStore:"=",dragSource:"="},templateUrl:"card-token.html",controller:["$scope",function(t){}]}}),(module=angular.module("utopia-card-upgrade",[])).directive("cardUpgrade",function(){return{scope:{upgrade:"=",ship:"=",fleet:"=",dragStore:"=",dragSource:"="},templateUrl:"card-upgrade.html",controller:["$scope",function(t){t.range=function(t){return new Array(t)},t.isDefined=function(t){return void 0!==t}}]}}),(module=angular.module("utopia-card",["utopia-tooltip","utopia-card-ship","utopia-card-ship-class","utopia-card-upgrade","utopia-card-resource","utopia-dragdrop","utopia-valueof"])).directive("card",function(){return{scope:{card:"=",ship:"=",fleet:"=",dragStore:"=",dragSource:"@"},restrict:"E",templateUrl:"card.html"}}),module.filter("icons",function(){return function(t){return t.replace(/\[([^\]]*)\]/g,"<i class='fs fs-$1'></i>").replace(/\n/g,"<br/>")}}),(module=angular.module("utopia-valueof",[])).filter("removeDashes",["$filter",function(t){return function(t){return t?t.replace(/\-/g," "):t}}]),module.factory("globalInterceptors",function(){return{cost:{priority:1e3,source:"Cost cannot be negative",hidden:!0,fn:function(t,e,a,r){return(r=r instanceof Function?r(t,e,a):r)<0?0:r}}}}),module.filter("upgradeSlots",function(){return function(t){var e=[];t.resource&&t.resource.upgradeSlots&&(e=e.concat(t.resource.upgradeSlots)),t.captain&&t.captain.upgradeSlots&&(e=e.concat(t.captain.upgradeSlots)),t.admiral&&t.admiral.upgradeSlots&&(e=e.concat(t.admiral.upgradeSlots)),e=e.concat(t.upgrades).concat(t.upgradeSlots);for(var a=[];0<e.length;){var r=e.shift();r&&(a.push(r),r.occupant&&r.occupant.upgradeSlots&&!r.faceDown&&(e=r.occupant.upgradeSlots.concat(e)))}return a}}),module.filter("shipInterceptors",["$filter",function(t){var c=t("upgradeSlots");return function(a,t,r,s,n){var i=[],e=c(t);return $.each(e,function(t,e){e.occupant&&e.occupant.intercept[r][s]&&!e.faceDown&&wrapInterceptors(e.occupant.intercept[r][s],e.occupant,i),(n&&e==n||a==e.occupant)&&e.intercept&&e.intercept[r]&&e.intercept[r][s]&&wrapInterceptors(e.intercept[r][s],e.source||"Unknown",i)}),t.resource&&t.resource.intercept[r][s]&&wrapInterceptors(t.resource.intercept[r][s],t.resource,i),t.captain&&t.captain.intercept[r][s]&&wrapInterceptors(t.captain.intercept[r][s],t.captain,i),t.admiral&&t.admiral.intercept[r][s]&&wrapInterceptors(t.admiral.intercept[r][s],t.admiral,i),t.intercept&&t.intercept[r][s]&&wrapInterceptors(t.intercept[r][s],t,i),i}}]),module.filter("interceptors",["$filter","globalInterceptors",function(t,i){var c=t("shipInterceptors");return function(a,t,e,r,s){var n=[];return a.intercept&&a.intercept.self&&a.intercept.self[r]&&wrapInterceptors(a.intercept.self[r],a,n),t&&(n=n.concat(c(a,t,"ship",r,s))),e&&($.each(e.ships||[],function(t,e){n=n.concat(c(a,e,"fleet",r))}),e.resource&&(n=n.concat(c(a,e.resource,"fleet",r)))),i[r]&&(n=n.concat(i[r])),n}}]),module.filter("valueOf",["$filter",function(t){var o=t("interceptors");return function(r,t,s,n,e,a){data=r[t],data=data instanceof Function?data(r,s,n):data;var i=[{source:"Printed Value",value:data}];if(s){var c=o(r,s,n,t,e);c.sort(function(t,e){return t.priority>e.priority?1:-1}),$.each(c,function(t,e){var a=data;data=e.fn(r,s,n,data),data==a||e.hidden||(data=data instanceof Function?data(r,s,n):data,a=a instanceof Function?a(r,s,n):a,data!=a&&i.push({source:e.source,value:data-a}))})}return data instanceof Function&&(data=data(r,s,n)),a&&a.modifiers?i:data}}]),angular.module("utopia").run(["$templateCache",function(t){"use strict";t.put("fleet-builder.html",'<div class="fleet-open-export" ng-show="!searchOptions.showExport">\n\t<button class="fleet-search-bigger" ng-click="searchOptions.showExport = true"><i class="fa fa-chevron-left"></i> Export</button>\n</div>\n\n<div class="fleet-open-search" ng-show="searchOptions.columns < 1">\n\t<button class="fleet-search-bigger" ng-click="searchOptions.columns = 1">Search <i class="fa fa-chevron-right"></i></button>\n</div>\n\n<div class="fleet-ship-container" ng-repeat="ship in fleet.ships track by $index">\n\n\t<div class="fleet-ship-top">\n\t\t<div class="fleet-ship-top-left" ng-class="{\'fleet-ship-top-left-first\':$first}"></div>\n\t\t<div class="fleet-ship-title font-staw" ng-class="{\'fleet-ship-title-long\': ship.name.length >= 18, \'fleet-ship-title-longer\': ship.name.length >= 21}">{{ ship.name }}</div>\n\t\t<div class="fleet-ship-top-spacer"></div>\n\t\t<div class="fleet-ship-title fleet-ship-cost font-staw">{{ getTotalCost(ship,fleet) }} SP</div>\n\t\t<div class="fleet-ship-top-spacer"></div>\n\t\t<div class="fleet-ship-top-spacer"></div>\n\t\t<div class="toggle-button-value pull-left" ng-class="{\'toggle-button-value-active\': !ship.hideEmptySlots}"></div>\n\t\t<div class="fleet-ship-title fleet-ship-cost font-staw">\n\t\t\t<button class="title-button" ng-click="ship.hideEmptySlots = !ship.hideEmptySlots">Show Empty Slots</button>\n\t\t</div>\n\t\t<div class="fleet-ship-top-right"></div>\n\t</div>\n\t<div class="fleet-ship-middle">\n\t\t<div class="fleet-ship-left"></div>\n\t\t\n\t\t<div class="fleet-ship-inner">\n\n\t\t\t<div class="card-container" ng-class="{\'zoom\':zoom}">\n\t\t\t\t<card card="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\x3c!--\n\t\t\tStupid whitespace breaks card alignment\n\t\t --\x3e<div class="card-container" ng-class="{\'zoom\':zoom}">\n\t\t\t\t<card card="ship.classData" ship="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\x3c!--\n\t\t --\x3e<div class="card-container" ng-class="{\'zoom\':zoom}" ng-show="!ship.squadron && fleet.resource && (fleet.resource|valueOf:\'showShipResourceSlot\':ship:fleet)" droppable can-drop="$item.type == fleet.resource.slotType" drop="setShipResource(fleet,ship,$item)" drag-store="dragStore">\n\t\t\t\t<div class="card-outer card-drop-target font-staw" ng-click="setSearchTypes([fleet.resource.slotType])">\n\t\t\t\t\t<div class="card-drop-target-inner">\n\t\t\t\t\t\t<div class="card-drop-target-type">\n\t\t\t\t\t\t\t<i class="fs fs-{{fleet.resource.slotType}}"></i><br/>{{fleet.resource.slotType|removeDashes}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<card card="ship.resource" ship="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\x3c!--\n\t\t\t\n\t\t --\x3e<div class="card-container" ng-class="{\'zoom\':zoom}" ng-hide="ship.squadron" droppable can-drop="$item.type == \'captain\' && $item != ship.captain" drop="setShipCaptain(fleet,ship,$item)" drag-store="dragStore">\n\t\t\t\t<div class="card-outer card-drop-target font-staw" ng-click="setSearchTypes([\'captain\'])">\n\t\t\t\t\t<div class="card-drop-target-inner">\n\t\t\t\t\t\t<div class="card-drop-target-type">\n\t\t\t\t\t\t\t<i class="fs fs-captain"></i><br/>Captain\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<card card="ship.captain" ship="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\x3c!--\n\n\t\t --\x3e<div class="card-container" ng-class="{\'zoom\':zoom}" ng-hide="!ship.admiral && ( ship.squadron || ship.hideEmptySlots || fleetHasAdmiral(fleet) )"\n\t\t\t\tdroppable can-drop="$item.type == \'admiral\' && $item != ship.admiral" drop="setShipAdmiral(fleet,ship,$item)" drag-store="dragStore">\n\t\t\t\t<div class="card-outer card-drop-target font-staw" ng-click="setSearchTypes([\'admiral\'])">\n\t\t\t\t\t<div class="card-drop-target-inner">\n\t\t\t\t\t\t<div class="card-drop-target-type">\n\t\t\t\t\t\t\t<i class="fs fs-admiral"></i><br/>Admiral\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<card card="ship.admiral" ship="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\x3c!--\n\t\t\t\n\t\t --\x3e<div class="card-container" ng-class="{\'zoom\':zoom}" ng-mouseenter="hover = true" ng-mouseleave="hover = false"\n\t\t\t\tng-repeat="upgradeSlot in ship|upgradeSlots" ng-hide="!upgradeSlot.occupant && (ship.hideEmptySlots || (upgradeSlot|valueOf:\'hide\':ship:fleet))" \n\t\t\t\tdroppable can-drop="isUpgradeCompatible($item, upgradeSlot, ship, fleet)" drop="setUpgrade(fleet,ship,upgradeSlot,$item)" drag-store="dragStore">\n\t\t\t\t<div class="card-outer card-drop-target font-staw" ng-click="setSearchTypes(upgradeSlot.type)">\n\t\t\t\t\t<div class="card-drop-target-title" ng-class="{\'card-drop-target-title-hover\':hover || upgradeSlot.occupant == dragStore.item}" ng-show="upgradeSlot.source && upgradeSlot.source != \'ship\'">{{upgradeSlot.source}}<div ng-show="upgradeSlot.rules">{{upgradeSlot.rules}}</div></div>\n\t\t\t\t\t<div class="card-drop-target-inner">\n\t\t\t\t\t\t<div class="card-drop-target-type" ng-repeat="type in upgradeSlot|valueOf:\'type\':ship:fleet">\n\t\t\t\t\t\t\t<i class="fs fs-{{type}}"></i><br/>{{type|removeDashes}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="card-drop-target-subtitle">{{upgradeSlot|valueOf:\'show\':ship:fleet}}</div>\n\t\t\t\t<card card="upgradeSlot.occupant" ship="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\n\t\t\t\n\t\t</div>\n\n\t</div>\n\t\n\t<div class="fleet-ship-bottom" ng-show="$last && searchOptions.columns < 1 && !fleet.resource">\n\t\t<div class="fleet-ship-bottom-left" ng-class="{\'fleet-ship-bottom-left-long\': fleet.ships.length > 0 || fleet.resource}"></div>\n\t</div>\n\t\t\n</div>\n\n<div class="fleet-ship-container" ng-hide="loading || ( searchOptions.columns < 1 && !fleet.resource )">\n\n\t<div class="fleet-ship-top">\n\t\t<div class="fleet-ship-top-left" ng-class="{\'fleet-ship-top-left-first\': fleet.ships.length == 0}"></div>\n\t\t<div class="fleet-ship-title font-staw">Fleet Total</div>\n\t\t<div class="fleet-ship-top-spacer"></div>\n\t\t<div class="fleet-ship-title fleet-ship-cost font-staw">{{ getFleetCost(fleet) }} SP</div>\n\t\t<div class="fleet-ship-top-right"></div>\n\t</div>\n\t\n\t<div class="fleet-ship-middle">\n\t\t<div class="fleet-ship-left"></div>\n\t\t\n\t\t<div class="fleet-ship-inner">\n\n\t\t\t<div class="card-container" ng-class="{\'zoom\':zoom}" ng-hide="searchOptions.columns < 1">\n\t\t\t\t<div class="card-outer card-drop-target font-staw" ng-click="setSearchTypes([\'ship\'])"\n\t\t\t\t\tdroppable can-drop="$item.type == \'ship\'" drop="addFleetShip(fleet,$item)" drag-store="dragStore">\n\t\t\t\t\t<div class="card-drop-target-title" ng-if="!isMobile">Click to search this card type</div>\n\t\t\t\t\t<div class="card-drop-target-title" ng-if="isMobile">Tap to search this card type</div>\n\t\t\t\t\t<div class="card-drop-target-inner">\n\t\t\t\t\t\t<div class="card-drop-target-type">\n\t\t\t\t\t\t\t<i class="fs fs-ship"></i><br/>Ship\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div ng-show="!isMobile" class="card-drop-target-subtitle">Drag here to add to fleet</div>\n\t\t\t\t\t<div ng-show="isMobile && (!dragStore.item || dragStore.item.type != \'ship\')" class="card-drop-target-subtitle">Tap a ship card to select it</div>\n\t\t\t\t\t<div ng-show="isMobile && dragStore.item && dragStore.item.type == \'ship\'" class="card-drop-target-subtitle">Tap here to add selected ship to fleet</div>\n\t\t\t\t</div>\n\t\t\t</div>\x3c!--\n\t\t\t\n\t\t\t--\x3e<div class="card-container" ng-class="{\'zoom\':zoom}" droppable can-drop="$item.type == \'resource\' && $item != fleet.resource" drop="setFleetResource(fleet,$item)" drag-store="dragStore">\n\t\t\t\t<div class="card-outer card-drop-target font-staw" ng-click="setSearchTypes([\'resource\'])">\n\t\t\t\t\t<div class="card-drop-target-title"></div>\n\t\t\t\t\t<div class="card-drop-target-inner">\n\t\t\t\t\t\t<div class="card-drop-target-type">\n\t\t\t\t\t\t\t<i class="fs fs-resource"></i><br/>Resource\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="card-drop-target-subtitle"></div>\n\t\t\t\t</div>\n\t\t\t\t<card card="fleet.resource" ship="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\x3c!--\n\t\t\t\n\t\t\t--\x3e<div class="card-container" ng-class="{\'zoom\':zoom}" ng-repeat="upgradeSlot in fleet.resource.upgradeSlots"\n\t\t\t\tdroppable can-drop="isUpgradeCompatible($item, upgradeSlot) && $item != upgradeSlot.occupant" drop="setUpgrade(fleet,fleet.resource,upgradeSlot,$item)" drag-store="dragStore">\n\t\t\t\t<div class="card-outer card-drop-target font-staw" ng-click="setSearchTypes(upgradeSlot.type)">\n\t\t\t\t\t<div class="card-drop-target-title">{{upgradeSlot.source}}<div ng-show="upgradeSlot.rules">{{upgradeSlot.rules}}</div></div>\n\t\t\t\t\t<div class="card-drop-target-inner">\n\t\t\t\t\t\t<div class="card-drop-target-type" ng-repeat="type in upgradeSlot.type">\n\t\t\t\t\t\t\t<i class="fs fs-{{type}}"></i><br/>{{type|removeDashes}}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="card-drop-target-subtitle"></div>\n\t\t\t\t</div>\n\t\t\t\t<card card="upgradeSlot.occupant" ship="ship" fleet="fleet" drag-store="dragStore"></card>\n\t\t\t</div>\n\t\t\t\n\t\t</div>\n\n\t</div>\n\t\n\t<div class="fleet-ship-bottom">\n\t\t<div class="fleet-ship-bottom-left fleet-ship-bottom-left-long"></div>\n\t</div>\n\t\n</div>'),t.put("fleet-export.html",'<div class="fleet-close-export" ng-show="searchOptions.showExport">\r\n\t<button class="fleet-search-bigger" ng-click="searchOptions.showExport = false"><i class="fa fa-chevron-right"></i> Export</button>\r\n</div>\r\n\r\n<div class="export-container">\r\n\t<div class="u-search-header"><div class="u-search-header-text">Copy Text Listing</div></div>\r\n\t<label class="export-option"><input type="checkbox" ng-model="showSetNames">Include Expansion Names</label>\r\n\t\x3c!-- New checkbox here for the table-top simulator option. --\x3e\r\n\t<label class="export-option"><input type="radio" ng-model="exportType" value="traditional">Traditional Export</label>\r\n\t<label class="export-option"><input type="radio" ng-model="exportType" value="tts">Table-Top Sim Export</label>\r\n\t\x3c!-- <label class="export-option"><input type="radio" ng-model="exportType" value="fleetSheet">Export JSON for Fleet Sheet</label> --\x3e\r\n\t<textarea class="export-text" ng-model="fleetText"></textarea>\r\n</div>\r\n'),t.put("fleet-list.html",'<div class="container-fluid">\n\n\t<div class="row" >\n\t\t<div class="col-md-4">\n\t\t</div>\n\t</div>\n\n</div>'),t.put("search-filter-group.html",'<div class="u-search-header" ng-click="showContent = !showContent"><div class="u-search-header-text">{{title}}</div></div>\n<div class="u-search-content" ng-show="showContent" ng-transclude></div>'),t.put("search.html",'<div class="u-search">\r\n\r\n\t<div class="search-query-container">\r\n\t\t<input class="u-search-query" ng-model="search.query" placeholder="Search" spellcheck="false" autocorrect="off">\r\n\t\t<button ng-click="resetSearch()">Reset</button>\r\n\t\t<button ng-click="showAdvanced = !showAdvanced">Advanced</button>\r\n\t</div>\r\n\r\n\t<div ng-show="showAdvanced && (!dragStore.item || dragStore.source == \'search\')">\r\n\r\n\t\t<div class="u-search-size">\r\n\t\t\t<button class="u-search-smaller" ng-click="modifySearchColumns(-1)"><i class="fa fa-chevron-left"></i></button>\r\n\t\t\t<div class="u-search-size-text">Resize Search Results</div>\r\n\t\t\t<button class="u-search-bigger" ng-click="modifySearchColumns(1)"><i class="fa fa-chevron-right"></i></button>\r\n\t\t</div>\r\n\r\n\t\t<search-filter-group title="Faction" open>\r\n\t\t\t<span ng-repeat="(faction,data) in search.factions">\r\n\t\t\t\t<label class="u-label"><input type="checkbox" ng-model="data.search" > <div class="u-faction card-faction-{{faction}}"></div> {{faction|removeDashes}}</label>\r\n\t\t\t</span>\r\n\t\t</search-filter-group>\r\n\r\n\t\t<search-filter-group title="Type" open>\r\n\t\t\t<span class="u-search-type" ng-repeat="(type,data) in search.types">\r\n\t\t\t\t<label class="u-label"><input type="checkbox" ng-model="data.search" > <i class="fs fs-{{type}}"></i> {{type|removeDashes}}</label>\r\n\t\t\t</span>\r\n\t\t</search-filter-group>\r\n\r\n\t\t<search-filter-group title="Uniqueness" open>\r\n\t\t\t<span>\r\n\t\t\t\t<label class="u-label"><input type="checkbox" ng-model="search.unique"> <i class="fs fs-unique"></i> Unique</label>\r\n\t\t\t</span>\r\n\t\t\t<span>\r\n\t\t\t\t<label class="u-label"><input type="checkbox" ng-model="search.generic"> <i class="fs"></i> Generic</label>\r\n\t\t\t</span>\r\n\t\t</search-filter-group>\r\n\r\n\t\t<search-filter-group title="Order By" open>\r\n\t\t\t<div class="u-search-filter-comment">\r\n\t\t\t\tOrder results by <select ng-model="search.sortBy" ng-options="sortable.value as sortable.name for sortable in sortables"></select>\r\n\t\t\t\t<select ng-model="search.ascending"><option value="true">Ascending</option><option value="false">Descending</option></select>\r\n\t\t\t\t<div class="u-order-default" ng-show="search.sortBy != defaults.search.sortBy || search.ascending != defaults.search.ascending">\r\n\t\t\t\t\t<button ng-click="defaults.search.sortBy = search.sortBy; defaults.search.ascending = search.ascending">Set as Default</button>\r\n\t\t\t\t\t<div>Default order is saved in browser for future sessions.</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</search-filter-group>\r\n\r\n\t\t<search-filter-group title="Custom Filter" open>\r\n\t\t\t<div class="u-search-filter-comment" ng-init="search.filterOperator = \'<\'">\r\n\t\t\t\t<select ng-model="search.filterField"><option value="">- No Filter -</option><option ng-repeat="sortable in sortables" value="{{sortable.value}}">{{sortable.name}}</option></select>\r\n\t\t\t\t<select ng-model="search.filterOperator"><option value="<">&lt;</option><option value="<=">&lt;=</option><option value="=">=</option><option value=">=">&gt;=</option><option value=">">&gt;</option></select>\r\n\t\t\t\t<input ng-model="search.filterValue" placeholder="Value"></input>\r\n\t\t\t</div>\r\n\t\t\t<div class="u-search-filter-comment">\r\n\t\t\t\tFilter On Maneuver: <select ng-model="search.maneuverType"><option value="">Any</option><option ng-repeat="maneuver in maneuvers" value="{{maneuver.value}}">{{maneuver.name}}</option></select>\r\n\t\t\t\t<select ng-model="search.maneuverDifficulty"><option value="">Any</option><option ng-repeat="difficulty in difficulty_list" value="{{difficulty.value}}">{{difficulty.name}}</option></select>\r\n\t\t\t</div>\r\n\t\t</search-filter-group>\r\n\r\n\t\t<search-filter-group title="Owned Expansions">\r\n\t\t\t<div class="u-search-filter-comment">\r\n\t\t\t\tExpansion filter settings are stored in your browser for future sessions. Uncheck the expansions you don\'t own. New expansions are automatically checked. These settings are not affected by the "Reset" button.\r\n\t\t\t</div>\r\n\t\t\t<div class="u-search-filter-comment">\r\n\t\t\t\t<label class="u-label"><input type="checkbox" ng-model="search.ignoreSetsFilter"> Temporarily show all cards</label>\r\n\t\t\t</div>\r\n\t\t\t<button ng-click="uncheckAllSets()">Uncheck all sets</button>\r\n\t\t\t<button ng-click="checkAllSets()">Check all sets</button>\r\n\t\t\t<button ng-click="exportSets()">Export Sets</button>\r\n\t\t\t<div class="u-search-filter-comment">Import Sets...</div>\r\n\t\t\t<input type="file" multiple onchange="angular.element(this).scope().importSets(this)">\r\n\t\t\t<div ng-repeat="set in setList | orderBy:\'-releaseDate\'" class="u-search-set" ng-hide="search.ignoreSetsFilter">\r\n\t\t\t\t<label class="u-label"><input type="checkbox" ng-model="search.sets[set.id].search"> {{set.parentSet}}: {{set.name}}</label>\r\n\t\t\t</div>\r\n\t\t</search-filter-group>\r\n\r\n\t</div>\r\n\r\n</div>\r\n\r\n<div ng-init="resultLimit = 10">\r\n\r\n\t<div class="u-loading" ng-show="loading">Loading cards...</div>\r\n\r\n\t<div class="card-container" ng-show="dragStore.item && dragStore.source != \'search\'" droppable can-drop="true" drop="$emit(\'removeFromFleetDropped\',$item)" drag-store="dragStore">\r\n\t\t<div class="card-outer card-drop-target font-staw">\r\n\t\t\t<div class="card-drop-target-inner">\r\n\t\t\t\t<div class="card-drop-target-type">\r\n\t\t\t\t\t<i class="fs fs-captain"></i><br/>Remove From Fleet\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div ng-hide="dragStore.item && dragStore.source != \'search\'">\r\n\r\n\t\t<div class="card-container" ng-repeat="card in cards | cardFilter:search | sortBy:search.sortBy:search.ascending | limitTo:resultLimit*search.columns">\r\n\t\t\t<card card="card" drag-store="dragStore" drag-source="search"></card>\r\n\t\t</div>\r\n\r\n\t\t<div>\r\n\t\t\t<button class="u-show-more" ng-hide="loading" ng-click="resultLimit = resultLimit + 10">Show More</button>\r\n\t\t</div>\r\n\r\n\t</div>\r\n\r\n</div>\r\n'),t.put("card-faction.html",'<div class="card-outer card-faction font-staw" ng-class="{ \'dragging\': faction == dragStore.item }" draggable drag-item="faction" drag-store="dragStore" drag-source="dragSource">\n\n\t<div class="card-faction-image card-faction-{{faction.factions[0]}}"></div>\n\n\t<div class="card-faction-name">{{faction.name | uppercase}}</div>\n\n</div>'),t.put("card-resource.html",'<div class="card-outer card-resource font-staw" ng-class="{ \'dragging\': resource == dragStore.item }" draggable drag-item="resource" drag-store="dragStore" drag-source="dragSource">\n\n\t<div class="card-resource-header">\n\t\t<span class="card-title" ng-class="{\'card-title-long\': resource.name.length > 20}">{{resource.name | uppercase}}<span ng-hide="resource.hideCost"> ({{resource|valueOf:\'cost\':ship:fleet}} SP)</span></span>\n\t\t\n\t</div>\n\t\n\t<div class="card-resource-header pull-right">\n\t\t<i ng-if="resource.opBanned" class="card-OP-banned-icon fs fs-opBanned"></i>\n\t</div>\n\t\n\t<div class="card-text">\n\t\t<div class="card-text-inner font-staw-alt" ng-bind-html="resource.text | icons"></div>\n\t</div>\n\n</div>'),t.put("card-ship-class.html",'<div class="card-outer card-ship card-shipclass font-staw">\r\n\r\n\t<div class="card-shipclass-arcs arc-faction-{{ship.factions[0]}}">\r\n\t\t<div class="arc arc-fill arc-fore-90" ng-show="shipClass.frontArc == 90"></div>\r\n\t\t<div class="arc arc-fill arc-fore-180" ng-show="shipClass.frontArc == 180"></div>\r\n\t\t<div class="arc arc-rear-90" ng-show="shipClass.rearArc == 90"></div>\r\n\t\t<div class="arc-hole"></div>\r\n\t\t<div class="arc-name">{{getBaseTileName(ship)}}</div>\r\n\t\t<div class="arc-stats">\r\n\t\t\t<div class="arc-stat card-ship-stat-attack text-center">{{ship|valueOf:\'attack\':ship:fleet}}</div>\r\n\t\t\t<div class="arc-stat card-ship-stat-agility text-center">{{ship|valueOf:\'agility\':ship:fleet}}</div>\r\n\t\t\t<div class="arc-stat card-ship-stat-hull text-center">{{ship|valueOf:\'hull\':ship:fleet}}</div>\r\n\t\t\t<div class="arc-stat card-ship-stat-shields text-center">{{ship|valueOf:\'shields\':ship:fleet}}</div>\r\n\t\t</div>\r\n\t\t<div class="arc-actions"><i ng-repeat="action in ship.actions" class="fs fs-{{action}}"></i></div>\r\n\t</div>\r\n\r\n\t\x3c!-- <div class="card-image" ng-class="{\'card-image-large\': Object.keys(shipClass.maneuvers).length > 9}"></div> --\x3e\r\n\t<div ng-class="(shipClass.id == \'borg_cube\') ? \'card-image-large\' : \'card-image\'"></div>\r\n\r\n\t<div class="card-corner-top-left pull-left">\r\n\t\t<div class="card-corner-inner pull-right"></div>\r\n\t</div>\r\n\t<div class="card-corner-top-right pull-right">\r\n\t\t<div class="card-corner-inner card-corner-inner-faction"></div>\r\n\t</div>\r\n\t<div class="card-title-container text-center">\r\n\t\t<span class="card-shipclass-title" ng-class="{\'card-title-long\': shipClass.name.length >= 20 }">{{shipClass.name | uppercase}}</span>\r\n\t</div>\r\n\r\n\t<div ng-class="(shipClass.id == \'borg_cube\') ? \'card-border-left-tall pull-left\' : \'card-border-left pull-left\'"></div>\r\n\r\n\t<div ng-class="(shipClass.id == \'borg_cube\') ? \'card-border-right-tall pull-right\' : \'card-border-right pull-right\'"></div>\r\n\r\n\t<div ng-class="(shipClass.id == \'borg_cube\') ? \'card-class-maneuvers-tall\' : \'card-class-maneuvers\'">\r\n\t\t<div class="card-maneuver-row" ng-repeat="speed in speeds track by $index">\r\n\t\t\t<div class="card-maneuver-box" ng-class="{\'speed-reverse\': speed < 0}"><span ng-show="speed != 9">{{abs(speed)}}</span></div>\r\n\t\t\t<div class="card-maneuver-box" ng-class="{\'card-maneuver-box-highlight\': shipClass.maneuvers[speed].turn || shipClass.maneuvers[speed][\'90-degree-rotate\']}">\r\n\t\t\t\t<i class="fs fs-turn-left speed-{{shipClass.maneuvers[speed].turn}}" ng-show="shipClass.maneuvers[speed].turn"></i>\r\n\t\t\t\t<i class="fs fs-90-rotate-left speed-{{shipClass.maneuvers[speed][\'90-degree-rotate\']}}" ng-show="shipClass.maneuvers[speed][\'90-degree-rotate\']"></i>\r\n\t\t\t</div>\r\n\t\t\t<div class="card-maneuver-box" ng-class="{\'card-maneuver-box-highlight\': shipClass.maneuvers[speed].bank || shipClass.maneuvers[speed].spin || shipClass.maneuvers[speed].flank || shipClass.maneuvers[speed][\'45-degree-rotate\']}">\r\n\t\t\t\t<i class="fs fs-bank-left speed-{{shipClass.maneuvers[speed].bank}}" ng-show="shipClass.maneuvers[speed].bank"></i>\r\n\t\t\t\t<i class="fs fs-spin-left speed-{{shipClass.maneuvers[speed].spin}}" ng-show="shipClass.maneuvers[speed].spin"></i>\r\n\t\t\t\t<i class="fs fs-left-flank speed-{{shipClass.maneuvers[speed].flank}}" ng-show="shipClass.maneuvers[speed].flank"></i>\r\n\t\t\t\t<i class="fs fs-45-rotate-left speed-{{shipClass.maneuvers[speed][\'45-degree-rotate\']}}" ng-show="shipClass.maneuvers[speed][\'45-degree-rotate\']"></i>\r\n\t\t\t</div>\r\n\t\t\t<div class="card-maneuver-box" ng-class="{\'card-maneuver-box-highlight\': shipClass.maneuvers[speed].straight || shipClass.maneuvers[speed].stop}">\r\n\t\t\t\t<i class="fs speed-{{shipClass.maneuvers[speed].straight}}" ng-class="{\'fs-forward\': speed > 0, \'fs-reverse\': speed < 0}" ng-show="shipClass.maneuvers[speed].straight"></i>\r\n\t\t\t\t<i class="fs fs-stop speed-{{shipClass.maneuvers[speed].stop}}" ng-show="shipClass.maneuvers[speed].stop"></i>\r\n\t\t\t</div>\r\n\t\t\t<div class="card-maneuver-box" ng-class="{\'card-maneuver-box-highlight\': shipClass.maneuvers[speed].bank || shipClass.maneuvers[speed].spin || shipClass.maneuvers[speed].flank || shipClass.maneuvers[speed][\'45-degree-rotate\']}">\r\n\t\t\t\t<i class="fs fs-bank-right speed-{{shipClass.maneuvers[speed].bank}}" ng-show="shipClass.maneuvers[speed].bank"></i>\r\n\t\t\t\t<i class="fs fs-spin-right speed-{{shipClass.maneuvers[speed].spin}}" ng-show="shipClass.maneuvers[speed].spin"></i>\r\n\t\t\t\t<i class="fs fs-right-flank speed-{{shipClass.maneuvers[speed].flank}}" ng-show="shipClass.maneuvers[speed].flank"></i>\r\n\t\t\t\t<i class="fs fs-45-rotate-right speed-{{shipClass.maneuvers[speed][\'45-degree-rotate\']}}" ng-show="shipClass.maneuvers[speed][\'45-degree-rotate\']"></i>\r\n\t\t\t</div>\r\n\t\t\t<div class="card-maneuver-box" ng-class="{\'card-maneuver-box-highlight\': shipClass.maneuvers[speed].turn || shipClass.maneuvers[speed][\'90-degree-rotate\']}">\r\n\t\t\t\t<i class="fs fs-turn-right speed-{{shipClass.maneuvers[speed].turn}}" ng-show="shipClass.maneuvers[speed].turn"></i>\r\n\t\t\t\t<i class="fs fs-90-rotate-right speed-{{shipClass.maneuvers[speed][\'90-degree-rotate\']}}" ng-show="shipClass.maneuvers[speed][\'90-degree-rotate\']"></i>\r\n\t\t\t</div>\r\n\t\t\t<div class="card-maneuver-box" ng-class="{\'card-maneuver-box-highlight\': shipClass.maneuvers[speed].about}">\r\n\t\t\t\t<i class="fs fs-come-about speed-{{shipClass.maneuvers[speed].about}}" ng-show="shipClass.maneuvers[speed].about"></i>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\r\n\t<div class="card-corner-bottom-left pull-left">\r\n\t\t<div class="card-corner-inner"></div>\r\n\t</div>\r\n\r\n\t<div class="card-corner-bottom-right pull-right">\r\n\t\t<div class="card-corner-inner"></div>\r\n\t</div>\r\n\r\n\t<div class="card-border-bottom"></div>\r\n\r\n\t<div style="clear: both"></div>\r\n\r\n</div>\r\n'),t.put("card-ship.html",'<div class="card-outer card-ship font-staw" ng-class="{ \'card-unique\': ship.unique, \'card-mirror\': ship.mirror, \'dragging\': ship == dragStore.item }" draggable drag-item="ship" drag-store="dragStore" drag-source="dragSource">\n\n\t<div class="card-image"></div>\n\n\t<div class="card-corner-top-left pull-left"><i ng-if="ship.unique" class="card-unique-icon fs fs-unique pull-left"></i>\n\t\t<div class="card-corner-inner pull-right"></div>\n\t</div>\n\t<div class="card-corner-top-right pull-right"><i ng-repeat="faction in ship|valueOf:\'factions\':ship:fleet" class="card-ship-faction card-faction-{{faction}} card-faction-{{$index}} fs fs-empty" ng-class="{\'card-factions-multiple\': (ship|valueOf:\'factions\':ship:fleet).length > 1}"></i>\n\t\t<div class="card-corner-inner card-corner-inner-faction"></div>\n\t</div>\n\t<div class="card-title-container text-center">\n\t\t<span class="card-title" ng-class="{\'card-title-long\': ship.name.length >= 20 }">{{ship.name | uppercase}}</span>\n\t</div>\n\n\t<div class="card-ship-stats pull-left">\n\t\t<div class="card-ship-stat card-ship-stat-attack text-right" tooltip-show="fleet" tooltip="ship|valueOf:\'attack\':ship:fleet:false:{modifiers:true}" tooltip-position="e"><span class="card-skill-plus" ng-show="ship.isShipModifier">+</span>{{ship|valueOf:\'attack\':ship:fleet}}</div>\n\t\t<div class="card-ship-stat card-ship-stat-agility text-right" tooltip-show="fleet" tooltip="ship|valueOf:\'agility\':ship:fleet:false:{modifiers:true}" tooltip-position="e"><span class="card-skill-plus" ng-show="ship.isShipModifier">+</span>{{ship|valueOf:\'agility\':ship:fleet}}</div>\n\t\t<div class="card-ship-stat card-ship-stat-hull text-right" tooltip-show="fleet" tooltip="ship|valueOf:\'hull\':ship:fleet:false:{modifiers:true}" tooltip-position="e"><span class="card-skill-plus" ng-show="ship.isShipModifier">+</span>{{ship|valueOf:\'hull\':ship:fleet}}</div>\n\t\t<div class="card-ship-stat card-ship-stat-shields text-right" tooltip-show="fleet" tooltip="ship|valueOf:\'shields\':ship:fleet:false:{modifiers:true}" tooltip-position="e"><span class="card-skill-plus" ng-show="ship.isShipModifier">+</span>{{ship|valueOf:\'shields\':ship:fleet}}</div>\n\t</div>\n\n\t<div class="card-border-right pull-right"></div>\n\n\t<div class="card-ship-silhouette pull-left"></div>\n\n\t<div class="card-ship-class-container text-center">\n\t\t<span class="card-ship-class" ng-class="{\'card-ship-class-long\': ship.class.length >= 25 }">{{ship.class | uppercase}}</span>\n\t</div>\n\n\t<div class="card-text font-staw-alt"><div class="card-text-inner" ng-bind-html="ship.text | icons" ng-class="{\'card-text-inner-long\': ship.text.length > 230 }"></div></div>\n\n\t<div class="card-ship-action-bar text-center">\n\t\t<i ng-repeat="action in ship.actions" class="fs fs-{{action}}"></i>\n\t</div>\n\n\t<div class="card-corner-bottom-right pull-right">\n\t\t<div class="card-corner-inner"></div>\n\t</div>\n\n\t<div class="card-ship-cost pull-right">{{ship|valueOf:\'cost\':ship:fleet}}</div>\n\n\t<div class="card-ship-upgrade-bar">\n\t\t<i ng-repeat="upgrade in ship.upgrades track by $index" class="fs fs-{{upgrade.type[0]}}" ng-class="{\'card-ship-upgrade-occupied\': upgrade.occupant}"></i>\n\t</div>\n\n\t<div style="clear: both"></div>\n\n</div>\n'),t.put("card-token.html",'<div class="card-outer card-token font-staw">\n\n\t<div class="card-token-header">\n\t\t<span class="card-title" ng-class="{\'card-title-long\': token.name.length > 20}">{{token.name | uppercase}}</span>\n\t</div>\n\n\t<div class="card-text">\n\t\t<div class="card-text-inner font-staw-alt" ng-bind-html="token.text | icons"></div>\n\t</div>\n\n</div>'),t.put("card-upgrade.html","<div class=\"card-outer card-upgrade font-staw\" ng-class=\"{ 'card-unique': upgrade.unique, 'card-OnePerShip': upgrade.OnePerShip, 'card-factionFederation': upgrade.factionFederation, 'card-FrontArc': upgrade.FrontArc, 'card-RearArc': upgrade.RearArc, 'card-Hull': upgrade.Hull, 'card-mirror': upgrade.mirror, 'dragging': upgrade == dragStore.item }\" draggable drag-item=\"upgrade\" drag-store=\"dragStore\" drag-source=\"dragSource\">\n\n\t<div class=\"card-image\"></div>\n\n"+'\t<div class="card-corner-top-left pull-left"><i ng-if="upgrade.unique" class="card-unique-icon fs fs-unique pull-left"></i><i ng-if="upgrade.OnePerShip" class="card-OnePerShip-icon fs fs-OnePerShip pull-left"></i>\n\t\t<div class="card-corner-inner pull-right"></div>\n\t</div>\n\n\t<div class="card-title-container text-left">\n\t\t<span ng-if="upgrade.showType" class="card-captain pull-right">{{upgrade.type|uppercase|removeDashes}}</span>\n\t\t<span ng-if="upgrade|valueOf:\'attack\':ship:fleet" class="card-weapon-attack pull-right" tooltip-show="ship" tooltip="upgrade|valueOf:\'attack\':ship:fleet:false:{modifiers:true}">{{upgrade|valueOf:\'attack\':ship:fleet}}</span>\n\t\t<span class="card-title"\n\t\t\tng-class="{ \'card-title-long\': upgrade.name.length >= 24 || (upgrade.showType && upgrade.name.length + upgrade.type.length >= 24) || (upgrade.attack && upgrade.name.length >= 20),\n\t\t\t\t\t\t\'card-title-super-long\': upgrade.name.length >= 31 || upgrade.showType && upgrade.name.length + upgrade.type.length >= 31,\n\t\t\t}">{{upgrade.name | uppercase}}</span>\n\t</div>\n\n\t<div class="card-border-left pull-left">\n\t\t<i ng-if="upgrade.captainFederation" class="card-captainFederation-icon fs fs-captainFederation"></i>\n\t\t<i ng-if="upgrade.captainBajoren" class="card-captainBajoren-icon fs fs-captainBajoren"></i>\n\t\t<i ng-if="upgrade.captainVulcan" class="card-captainVulcan-icon fs fs-captainVulcan"></i>\n\t\t<i ng-if="upgrade.captainKlingon"  class="card-captainKlingon-icon fs fs-captainKlingon"></i>\t\n\t\t<i ng-if="upgrade.captainRomulan" class="card-captainRomulan-icon fs fs-captainRomulan"></i>\t\n\t\t<i ng-if="upgrade.captainDominion" class="card-captainDominion-icon fs fs-captainDominion"></i>\n\t\t<i ng-if="upgrade.captainIndependent" class="card-captainIndependent-icon fs fs-captainIndependent"></i>\n\t\t<i ng-if="upgrade.captainFerengi" class="card-captainFerengi-icon fs fs-captainFerengi"></i>\n\t\t<i ng-if="upgrade.captainKazon" class="card-captainKazon-icon fs fs-captainKazon"></i>\n\t\t<i ng-if="upgrade.captainXindi" class="card-captainFerengi-icon fs fs-captainFerengi"></i>\n\t\t<i ng-if="upgrade.captainBorg" class="card-captainBorg-icon fs fs-captainBorg"></i>\n\t\t<i ng-if="upgrade.captain8472" class="card-captain8472-icon fs fs-captain8472"></i>\n\t\t<i ng-if="upgrade.captainMU" class="card-captainMU-icon fs fs-captainMU"></i>\n\t\t\n\t\t<i ng-if="upgrade.shipFederation" class="card-shipFederation-icon fs fs-card-shipFederation"></i>\n\t\t<i ng-if="upgrade.shipBajoren" class="card-shipBajoren-icon fs fs-card-shipBajoren"></i>\n\t\t<i ng-if="upgrade.shipVulcan" class="card-shipVulcan-icon fs fs-card-shipVulcan"></i>\n\t\t<i ng-if="upgrade.shipKlingon" class="card-shipKlingon-icon fs fs-shipKlingon"></i>\t\n\t\t<i ng-if="upgrade.shipRomulan" class="card-shipRomulan-icon fs fs-shipRomulan"></i>\t\n\t\t<i ng-if="upgrade.shipDominion" class="card-shipDominion-icon fs fs-shipDominion"></i>\n\t\t<i ng-if="upgrade.shipIndependent" class="card-shipIndependent-icon fs fs-shipIndependent"></i>\n\t\t<i ng-if="upgrade.shipFerengi" class="card-shipFerengi-icon fs fs-shipFerengi"></i>\n\t\t<i ng-if="upgrade.shipKazon" class="card-shipKazon-icon fs fs-shipKazon"></i>\n\t\t<i ng-if="upgrade.shipXindi" class="card-shipXindi-icon fs fs-shipXindi"></i>\n\t\t<i ng-if="upgrade.shipBorg" class="card-shipBorg-icon fs fs-shipBorg"></i>\n\t\t<i ng-if="upgrade.ship8472" class="card-ship8472-icon fs fs-ship8472"></i>\n\t\t<i ng-if="upgrade.shipMU" class="card-shipMU-icon fs fs-shipMU"></i>\n\t\t\n\t\t<i ng-if="upgrade.costFederation" class="card-costFederation-icon">{{upgrade|valueOf:\'costFederation\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costBajoren" class="card-costBajoren-icon">{{upgrade|valueOf:\'costFederation\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costVulcan" class="card-costVulcan-icon">{{upgrade|valueOf:\'costVulcan\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costKlingon" class="card-costKlingon-icon">{{upgrade|valueOf:\'costKlingon\':ship:fleet}}</i>\t\n\t\t<i ng-if="upgrade.costRomulan" class="card-costRomulan-icon">{{upgrade|valueOf:\'costRomulan\':ship:fleet}}</i>\t\n\t\t<i ng-if="upgrade.costDominion" class="card-costDominion-icon">{{upgrade|valueOf:\'costDominion\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costIndependent" class="card-costIndependent-icon">{{upgrade|valueOf:\'costIndependent\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costFerengi" class="card-costFerengi-icon">{{upgrade|valueOf:\'costFerengi\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costKazon" class="card-costKazon-icon">{{upgrade|valueOf:\'costKazon\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costXindi" class="card-costXindi-icon">{{upgrade|valueOf:\'costXindi\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costBorg" class="card-costBorg-icon">{{upgrade|valueOf:\'costBorg\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.cost8472" class="card-cost8472-icon">{{upgrade|valueOf:\'cost8472\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.costMU" class="card-costMU-icon">{{upgrade|valueOf:\'costMU\':ship:fleet}}</i>\n\t\t\n\t\t<i ng-if="upgrade.hullConstraint" class="card-hullConstraint-icon">{{upgrade|valueOf:\'hullConstraint\':ship:fleet}}</i>\n\t\t<i ng-if="upgrade.FrontArc" class="card-FrontArc-icon fs fs-FrontArc"></i>\t\t\n\t\t<i ng-if="upgrade.RearArc" class="card-RearArc-icon fs fs-RearArc"></i>\n\t\t<i ng-if="upgrade.arc360" class="card-360Arc-icon fs fs-360Arc"></i>\n\t\t<i ng-if="upgrade.shipLimit" class="card-shipLimit-icon fs fs-shipLimit"></i>\n\t\t\n\t\t<i ng-if="upgrade.opBanned" class="card-OP-banned-icon fs fs-opBanned"></i>\n\t</div>\n\t\n\t<div class="card-text">\n\t\t<div ng-if="upgrade.range" class="card-weapon-range pull-right">{{upgrade|valueOf:\'range\':ship:fleet}}</div>\n\t\t<div class="card-text-inner font-staw-alt" ng-bind-html="upgrade.text | icons" ng-class="{\'card-text-inner-long\': upgrade.text.length > 300, \'card-text-inner-super-long\': upgrade.text.length > 530, \'text-left\': upgrade.range }"></div>\n\t</div>\n\n\t<div class="card-upgrade-cost pull-right"><div ng-repeat="faction in upgrade|valueOf:\'factions\':ship:fleet" class="card-upgrade-faction card-faction-{{ (upgrade|valueOf:\'factions\':ship:fleet).length - $index}}"><div class="card-upgrade-faction-black"></div><div class="card-upgrade-faction-icon card-faction-{{faction}}"></div></div><div class="card-upgrade-cost-value" ng-class="{\'card-upgrade-cost-free\': \'{{upgrade|valueOf:\'free\':ship:fleet}}\' }" tooltip-show="ship" tooltip="upgrade|valueOf:\'cost\':ship:fleet:false:{modifiers:true}">{{upgrade|valueOf:\'cost\':ship:fleet}}</div></div>\n\n\t<div ng-if="upgrade.type == \'captain\' || upgrade.type == \'admiral\' || (upgrade|valueOf:\'skill\':ship:fleet)" class="card-skill-container pull-left">\n\t\t<div class="card-skill" tooltip-show="ship" tooltip="upgrade|valueOf:\'skill\':ship:fleet:false:{modifiers:true}" tooltip-position="nw-alt"><span class="card-skill-plus" ng-show="upgrade.isSkillModifier && upgrade.skill >= 0">+</span>{{upgrade|valueOf:\'skill\':ship:fleet}}</div>\n\t</div>\n\n\t<div ng-if="!(upgrade|valueOf:\'skill\':ship:fleet) && upgrade.type != \'captain\' && upgrade.type != \'admiral\' " class="card-upgrade-type pull-left fs fs-{{upgrade.type}}"></div>\n\n\t<div class="card-border-bottom">\n\t\t<i ng-if="upgrade.talents" ng-repeat="talent in range(upgrade.talents) track by $index" class="fs fs-talent"></i>\n\t\t<i ng-repeat="slot in upgrade.upgradeSlots track by $index" ng-if="slot.showOnCard" class="fs fs-{{slot.type[0]}}" ng-class="{\'card-upgrades-long\': upgrade.upgradeSlots.length > 2}"></i>\n\t</div>\n\n\t<div style="clear: both"></div>\n\n</div>'),t.put("card.html",'<div ng-if="card" ng-switch on="card.type">\n\t<card-ship \t\t\tng-switch-when="ship" ship="card" drag-store="dragStore" drag-source="dragSource" fleet="fleet"></card-ship>\n\t<card-ship \t\t\tng-switch-when="flagship" ship="card" drag-store="dragStore" drag-source="dragSource" fleet="fleet"></card-ship>\n\t<card-ship-class\tng-switch-when="ship-class" ship-class="card" ship="ship" fleet="fleet"></card-ship-class>\n\t<card-resource \t\tng-switch-when="resource" resource="card" drag-store="dragStore" drag-source="dragSource" ship="ship" fleet="fleet"></card-resource>\n\t<card-token \t\tng-switch-when="token" token="card" drag-store="dragStore" drag-source="dragSource" ship="ship" fleet="fleet"></card-token>\n\t<card-faction \t\tng-switch-when="faction" faction="card" drag-store="dragStore" drag-source="dragSource" ship="ship" fleet="fleet"></card-faction>\n\t<card-upgrade \t\tng-switch-default upgrade="card" drag-store="dragStore" drag-source="dragSource" ship="ship" fleet="fleet"></card-upgrade>\n</div>')}]);
//# sourceMappingURL=utopia.min.js.map