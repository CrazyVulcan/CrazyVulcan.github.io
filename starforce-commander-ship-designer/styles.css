:root { color-scheme: dark; font-family: Inter, Segoe UI, Roboto, sans-serif; }
body { margin: 0; background: #0d1222; color: #eaf0ff; }
.layout { display: grid; grid-template-columns: minmax(340px, 430px) 1fr; gap: 1rem; padding: 1rem; }
.panel { background: #151d35; border: 1px solid #25315c; border-radius: 10px; padding: 1rem; }
.controls { max-height: calc(100vh - 2rem); overflow: auto; }
.preview-wrap { position: sticky; top: 1rem; align-self: start; }
.stack label { display: block; margin: 0.5rem 0; }
textarea, input, button { width: 100%; margin-top: 0.25rem; padding: 0.45rem; border-radius: 8px; border: 1px solid #32427a; background: #0f1731; color: #eaf0ff; }
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.65rem; }
.shield-stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.65rem; margin-bottom: 0.35rem; }
.shield-stat-card { margin: 0; border: 1px solid #32427a; border-radius: 8px; padding: 0.45rem 0.55rem 0.55rem; background: #0f1731; }
.shield-stat-card legend { padding: 0 0.2rem; font-weight: 700; color: #dbe7ff; }
.shield-stat-card label { margin: 0.28rem 0 0; }
.shield-stat-card input { margin-top: 0.15rem; }
.row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.5rem; margin-top: 0.75rem; }

.grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0.55rem; }
.maneuver-editor { border: 1px solid #32427a; border-radius: 8px; padding: 0.6rem; margin-top: 0.5rem; background: #0f1731; }
.maneuver-editor strong { display: block; margin-bottom: 0.45rem; }
.maneuver-grid-head, .maneuver-grid { display: grid; grid-template-columns: 52px 84px 1fr; gap: 0.45rem; align-items: center; }
.maneuver-grid-head { margin: 0.5rem 0 0.2rem; color: #a7b4da; font-size: 0.78rem; }
.maneuver-grid label { margin: 0; font-weight: 700; }
.maneuver-grid input[type="checkbox"] { width: 20px; height: 20px; margin: 0; justify-self: start; }
.maneuver-grid select { margin: 0; }
.power-system-editor { border: 1px solid #32427a; border-radius: 8px; padding: 0.6rem; margin-top: 0.5rem; background: #0f1731; }
.power-system-editor strong { display: block; margin-bottom: 0.2rem; }
.power-system-editor .muted { margin: 0 0 0.5rem; font-size: 0.82rem; }
.power-grid-head, .power-grid { display: grid; grid-template-columns: minmax(0, 1fr) 74px 96px minmax(0, 1fr) 44px; gap: 0.4rem; align-items: center; }
.power-grid-head { margin: 0.2rem 0; color: #a7b4da; font-size: 0.78rem; }
.power-grid label { margin: 0; font-weight: 700; }
.power-grid input { margin: 0; }
.power-grid input[type="checkbox"] { width: 18px; height: 18px; justify-self: center; }
.functions-editor { border: 1px solid #3557c7; border-radius: 8px; padding: 0.6rem; margin-top: 0.5rem; background: #07133e; }
.functions-editor strong { display: block; margin-bottom: 0.15rem; font-size: 1.02rem; }
.functions-editor .muted { margin: 0 0 0.5rem; font-size: 0.82rem; color: #bdd0ff; }
.functions-mini-head { display: grid; grid-template-columns: 108px 1fr; margin-bottom: 0.2rem; color: #a7b4da; font-size: 0.85rem; }
.fn-edit-row { display: grid; grid-template-columns: 108px minmax(0, 1fr) auto; gap: 0.35rem; align-items: center; margin-bottom: 0.34rem; }
.fn-edit-row input { margin: 0; }
.fn-edit-row input[type="checkbox"] { width: 16px; height: 16px; }
.fn-edit-label { font-weight: 900; }
.fn-edit-subrow { grid-template-columns: 108px auto; }
.fn-divider { height: 1px; background: #1f3b8e; margin: 0.35rem 0 0.45rem; }
.fn-wpn-row { grid-template-columns: 72px minmax(0, 1fr) auto 90px; }
.fn-on-label { white-space: nowrap; }
.inline-check { display: inline-flex !important; align-items: center; gap: 0.35rem; font-weight: 800; }
.inline-check input { width: 16px; margin: 0; }
.free-check { color: #e6ecff; }
.tiny { font-size: 0.72rem; }
button { cursor: pointer; background: #3d62ff; border: none; font-weight: 600; }
button.ghost { background: #273055; }
.muted { color: #a7b4da; }
.preview-head { display: flex; justify-content: space-between; align-items: center; }
.live-badge { background: #11b96b; color: #072b19; font-size: 0.76rem; font-weight: 800; border-radius: 999px; padding: 0.12rem 0.5rem; }

.ssd-template {
  border: 3px solid #0b71ba;
  background: #d9d9d9;
  color: #04111f;
  border-radius: 0;
  overflow: hidden;
  font-family: Arial Black, Arial, Helvetica, sans-serif;
}
.template-top {
  display: grid;
  grid-template-columns: minmax(220px, 1fr) 1.5fr;
  gap: 0.35rem;
  border-bottom: 3px solid #0b71ba;
  background: #d9d9d9;
  padding: 0.15rem;
  position: relative;
}
.template-top::before,
.template-top::after {
  content: "";
  width: 48px;
  height: 44px;
  border: 4px solid #111;
  background: #5a6a76;
  border-radius: 22px;
  position: absolute;
  top: 1px;
}
.template-top::before { left: -1px; }
.template-top::after { right: -1px; }
.template-ship,
.template-class {
  padding: 0.45rem 0.6rem;
  font-weight: 900;
  font-size: 1.05rem;
  border: 3px solid #0e3f8c;
  background: #c8d5e3;
  text-transform: uppercase;
}
.template-ship {
  margin-left: 3.2rem;
  text-align: center;
  color: #b7b7b7;
}
.template-class {
  margin-right: 3.2rem;
  border-color: transparent;
  background: transparent;
  color: #000;
  text-align: right;
}
.template-columns { display: grid; grid-template-columns: 1.06fr 0.94fr 0.72fr; gap: 0.4rem; padding: 0.25rem 0.15rem 0.2rem; align-items: stretch; }
.col h3 { margin: 0 0 0.2rem; background: #566674; color: #f3f3f3; text-align: center; padding: 0.1rem 0.3rem; border: 3px solid #111; font-size: 1.02rem; letter-spacing: 0.02em; }

.left-col,
.middle-col,
.right-col {
  display: flex;
  flex-direction: column;
}

.left-col {
  min-height: 920px;
}

.functions-preview { height: 220px; max-height: 220px; overflow: auto; padding: 0.2rem 0.35rem 0.28rem; color: #111; font-family: Arial, Helvetica, sans-serif; }
.block-maneuver { display: flex; flex-direction: column; }
.block-maneuver .maneuver-preview { height: 110px; max-height: 110px; overflow: hidden; }

.eng-stats { display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.15rem; margin-bottom: 0.2rem; }
.eng-stats span { background: #566674; color: #fff; text-align: center; padding: 0.25rem 0.1rem; border: 2px solid #f5f5f5; font-size: 0.9rem; font-weight: 900; }
.stat-icon { width: 18px; height: 18px; object-fit: contain; vertical-align: text-bottom; }
.stat-tag { color: #b8b8b8 !important; background: #e9eef3 !important; border-color: #10a5df !important; }
.green-block { border: 2px solid #02a45c; background: #f0f0f0; margin-bottom: 0.2rem; }
.green-block h4 { margin: 0; background: #07af52; color: #fff; padding: 0.15rem 0.25rem; font-size: 0.74rem; letter-spacing: 0.01em; display: flex; justify-content: space-between; }
.block-power h4 span:last-child { color: #d8ffd8; }
.green-block pre { min-height: 80px; margin: 0; background: transparent; color: #233; white-space: pre-wrap; border-radius: 0; font-family: Arial, Helvetica, sans-serif; font-size: 0.8rem; }
.fn-row { display: grid; grid-template-columns: 120px minmax(0, 1fr); align-items: center; gap: 0.35rem; margin-bottom: 0.12rem; font-weight: 900; font-size: 0.75rem; }
.fn-name { text-transform: uppercase; letter-spacing: 0.01em; }
.fn-name.green { color: #0aa14e; }
.fn-name.magenta { color: #d31ce0; }
.fn-name.cyan { color: #08a7df; }
.fn-name.gold { color: #e3ab00; }
.fn-name.red { color: #ff0000; }
.fn-levels { display: flex; flex-wrap: wrap; align-items: center; gap: 0.24rem; font-weight: 900; }
.fn-token { display: inline-flex; align-items: center; justify-content: center; min-width: 12px; }
.fn-emer { margin-left: auto; display: inline-flex; align-items: center; gap: 0.24rem; }
.fn-dot {
  width: 14px;
  height: 14px;
  border: 2px solid #09a84f;
  border-radius: 50%;
  box-sizing: border-box;
  display: inline-block;
}
.fn-dot.filled { background: #09a84f; }
.fn-end-round { font-size: 0.65rem; margin-left: 0.35rem; color: #2f2f2f; }
.power-track-list { min-height: 156px; margin: 0; padding: 0.25rem 0.3rem; color: #111; font-family: Arial, Helvetica, sans-serif; overflow: auto; }
.power-track-row { display: grid; grid-template-columns: 132px minmax(0, 1fr); align-items: center; gap: 0.45rem; margin-bottom: 0.2rem; font-size: 0.72rem; font-weight: 700; }
.power-track-name { text-transform: uppercase; white-space: nowrap; }
.power-track-units { display: flex; flex-wrap: wrap; gap: 0.38rem; }
.power-unit { display: inline-flex; align-items: center; gap: 0.2rem; }
.power-dot {
  width: 14px;
  height: 14px;
  border: 2px solid #09a84f;
  border-radius: 50%;
  background: #09a84f;
  box-sizing: border-box;
  flex: 0 0 auto;
}
.power-dot.is-ring { background: transparent; border-width: 3px; }
.power-box {
  width: 14px;
  height: 14px;
  border: 3px solid #111;
  box-sizing: border-box;
  background: #f2f2f2;
  display: inline-block;
  flex: 0 0 auto;
}

.middle-col { border: 3px solid #10a5df; background: #14a7de; padding: 0.15rem; }
.shield-frame { position: relative; border: 3px solid #10a5df; background: #14a7de; padding: 0.18rem 1rem 0.12rem; }
.shield-inner { position: relative; z-index: 1; overflow: visible; background: #ececec; border: 2px solid #ececec; }
.shield-top, .shield-bottom { background: #17a8df; color: #fff; text-align: center; font-weight: 900; padding: 0.12rem; font-size: 0.95rem; letter-spacing: 0.03em; }
.shield-top { margin-bottom: 0.12rem; }
.shield-bottom { margin-top: 0.12rem; }
.shield-box-row { display: flex; flex-wrap: wrap; gap: 4px; padding: 0.12rem 0.35rem; min-height: 20px; justify-content: center; }
.armor-box-row { display: flex; flex-wrap: wrap; gap: 4px; padding: 0.08rem 0.35rem; min-height: 18px; justify-content: center; }
.shield-gen-row { display: flex; flex-wrap: wrap; gap: 4px; padding: 0.12rem 0.35rem; min-height: 18px; justify-content: center; }
.fwd-gen-row { padding-top: 0.16rem; padding-bottom: 0.04rem; }
.shield-gen-label { text-align: center; font-weight: 900; color: #0872c2; margin: 0.08rem 0 0.12rem; display: flex; justify-content: center; align-items: center; gap: 6px; font-size: 0.92rem; }
.shield-gen-black-row { display: flex; gap: 4px; flex-wrap: wrap; }
.shield-box {
  width: 12px;
  height: 12px;
  border: 2px solid #08a8df;
  box-sizing: border-box;
}
.armor-box {
  width: 12px;
  height: 12px;
  border: 2px solid #7a7a7a;
  box-sizing: border-box;
  background: transparent;
}
.shield-gen {
  width: 12px;
  height: 12px;
  border: 3px solid #00b050;
  box-sizing: border-box;
}
.shield-gen-black {
  width: 12px;
  height: 12px;
  border: 3px solid #111;
  box-sizing: border-box;
  background: #eee;
}

.shield-body { position: relative; height: 385px; background: #ececec; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.ship-art-wrap { width: 76%; height: 100%; max-height: 100%; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.ship-art { width: 100%; height: 100%; object-fit: contain; display: none; filter: saturate(0.9) contrast(1.02); }
.ship-silhouette { width: 58%; height: 82%; background: linear-gradient(180deg,#d8d8d8,#b5b5b5); border: 3px solid #121212; border-radius: 46% 46% 30% 30% / 58% 58% 42% 42%; }
.side {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  display: grid;
  align-items: center;
  column-gap: 6px;
}
.side-port {
  left: 8px;
  grid-template-columns: auto auto auto;
}
.side-stbd {
  right: 8px;
  grid-template-columns: auto auto auto;
}
.side-port .shield-gen-col { order: 1; }
.side-port .shield-box-col { order: 2; }
.side-port .armor-box-col { order: 3; }
.side-stbd .armor-box-col { order: 1; }
.side-stbd .shield-box-col { order: 2; }
.side-stbd .shield-gen-col { order: 3; }
.side-label {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  color: #fff;
  font-weight: 900;
  font-size: 1rem;
  line-height: 1;
  z-index: 3;
  writing-mode: vertical-rl;
  text-orientation: mixed;
  letter-spacing: 0.04em;
  display: inline-flex;
  align-items: center;
  gap: 0.2rem;
  padding: 0.2rem 0.08rem;
}

.side-label b {
  font-size: 1rem;
  line-height: 1;
}

.side-label-port {
  left: 0.08rem;
  transform: translateY(-50%) rotate(180deg);
}
.side-label-stbd {
  right: 0.08rem;
}
.shield-box-col, .shield-gen-col, .armor-box-col {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-height: 112px;
  justify-content: center;
}
.systems-box { border-top: 0; margin-top: 0.3rem; border: 2px solid #f0b500; background: #f8f8f8; padding-bottom: 0.25rem; }
.systems-box h3 { border-color: #f0b500; }
.systems-layout { display: grid; grid-template-columns: 1fr 72px; gap: 0.35rem; padding: 0.2rem 0.25rem 0.1rem; align-items: start; }
.systems-grid { min-height: 158px; display: grid; grid-template-columns: 1fr 1fr; column-gap: 0.4rem; align-content: start; }
.system-row { display: flex; align-items: center; gap: 3px; font-family: Arial, Helvetica, sans-serif; font-size: 0.72rem; font-weight: 900; color: #111; margin-bottom: 0.08rem; }
.system-key { min-width: 42px; }
.system-box { width: 10px; height: 10px; border: 2px solid #111; box-sizing: border-box; background: #f7f7f7; }
.systems-side { display: flex; flex-direction: column; gap: 0.45rem; }
.crew-box { border: 4px solid #f0b500; background: #fff; min-height: 64px; display: flex; align-items: center; justify-content: center; gap: 0.3rem; color: #16b15c; font-weight: 900; font-size: 1.8rem; }
.crew-box b { color: #111; font-size: 2rem; line-height: 1; }
.crew-icon { font-size: 1.6rem; line-height: 1; }
.crew-img { width: 28px; height: 28px; display: block; }

.weapon-editor-list { display: grid; gap: 0.5rem; }
.weapon-editor-card { border: 2px solid #0fb366; border-radius: 0; padding: 0.45rem 0.5rem; background: #f3f4f6; }
.weapon-editor-card legend { font-weight: 900; color: #0a3f5f; padding: 0 0.22rem; text-transform: uppercase; font-size: 0.8rem; }
.weapon-editor-card code { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 0.78rem; }
.weapon-editor-card label { color: #1f2b46; font-weight: 700; }
.weapon-editor-card input { border-color: #2b447f; }
.weapon-editor-card .grid2,
.weapon-editor-card .grid3 { grid-template-columns: 1fr; gap: 0.45rem; }

.right-col { border: 3px solid #ff0000; background: #fafafa; }
.weapon-slot { border-top: 2px solid #ff0000; height: 170px; min-height: 170px; display: flex; flex-direction: column; }
.weapon-slot:first-of-type { border-top: 0; }
.slot-title { background: #ff0000; color: #fff; font-weight: 900; padding: 0.17rem 0.3rem; }
.slot-body { color: #233; padding: 0.35rem 0.38rem; min-height: 0; flex: 1; overflow: auto; font-family: Arial, Helvetica, sans-serif; font-size: 0.74rem; }
.wpn-mount-row,.wpn-power-row,.wpn-structure-row,.wpn-special-row,.wpn-trait-row { display: flex; align-items: center; gap: 0.18rem; margin-bottom: 0.18rem; flex-wrap: wrap; }
.wpn-mount { display: grid; gap: 0.12rem; justify-items: center; }
.wpn-mount-svg { width: 48px; height: 48px; display: block; }
.wpn-sector { fill: #ffffff; stroke: #6b1717; stroke-width: 0.9; }
.wpn-sector.active { fill: #ff1212; }
.wpn-mount-outline { fill: none; stroke: #6b1717; stroke-width: 1.4; }
.wpn-mount-structure { display: inline-flex; gap: 0.08rem; }
.wpn-power-circle { width: 12px; height: 12px; border-radius: 999px; border: 3px solid #11a854; display: inline-block; box-sizing: border-box; }
.wpn-power-stop { width: 8px; height: 8px; background: #11a854; transform: rotate(45deg); display: inline-block; }
.wpn-structure-row b { margin-right: 0.25rem; }
.wpn-structure-box { width: 10px; height: 10px; border: 2px solid #111; display: inline-block; }
.wpn-range-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(56px, 1fr)); gap: 0.15rem 0.24rem; align-items: start; }
.wpn-range-col { display: grid; grid-template-rows: auto auto; gap: 0.1rem; justify-items: center; }
.wpn-range-band { text-align: center; font-weight: 800; font-size: 0.74rem; }
.wpn-range-band.green { color: #10b981; }
.wpn-range-band.black { color: #111827; }
.wpn-range-band.red { color: #dc2626; }
.wpn-dice-row { display: flex; justify-content: center; gap: 0.08rem; flex-wrap: wrap; }
.wpn-die { width: 13px; height: 13px; border-radius: 999px; color: #fff; display: inline-flex; align-items: center; justify-content: center; font-size: 0.48rem; font-weight: 900; }
.wpn-die.r { background: #ef4444; }
.wpn-die.y { background: #eab308; color: #111; }
.wpn-die.g { background: #22c55e; }
.wpn-die.b { background: #3b82f6; }
.wpn-special-row b,.wpn-trait-row b { color: #0b67b2; }

.template-bottom {
  --structure-box-size: 12px;
  --structure-box-gap: 4px;
  display: grid;
  grid-template-columns: auto minmax(0, 1fr) auto;
  align-items: center;
  gap: 0.22rem;
  background: #d9d9d9;
  color: #fff;
  font-weight: 900;
  padding: 0.1rem 0.15rem;
  border-top: 3px solid #0d78c5;
}
.structure {
  letter-spacing: 0.03em;
  background: #566674;
  border: 3px solid #111;
  padding: 0.03rem 0.6rem;
}
.structure-track {
  position: relative;
  min-height: 30px;
  border: 3px solid #f0b500;
  background: #fff;
  padding: 0.14rem 0.2rem;
}
.structure-row {
  display: flex;
  align-items: flex-start;
  flex-wrap: nowrap;
  gap: 3px;
  min-height: var(--structure-box-size);
  overflow: hidden;
}
.structure-inline-marker {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 24px;
  color: #111;
  font-size: 0.82rem;
  line-height: 1;
  font-family: Arial, Helvetica, sans-serif;
  margin: 0 1px;
  gap: 1px;
}
.team-count {
  font-weight: 900;
}
.wrench-icon {
  width: 10px;
  height: 10px;
  display: inline-block;
  background: center / contain no-repeat url("assets/wrench-icon.svg");
}
.structure-box {
  width: var(--structure-box-size);
  height: var(--structure-box-size);
  border: 2px solid #111;
  box-sizing: border-box;
  background: transparent;
}
.structure-box.repairable {
  position: relative;
}
.structure-box.repairable::after {
  content: '';
  position: absolute;
  left: -2px;
  right: -2px;
  bottom: -4px;
  border-bottom: 2px solid #111;
}
.structure-box.permanent {
  border-color: #d10000;
  background: transparent;
}

.footer-tags {
  display: flex;
  align-items: center;
  gap: 0.15rem;
}
#pvFaction,
#pvEra {
  background: #566674;
  border: 3px solid #111;
  padding: 0.02rem 0.55rem;
  min-width: 86px;
  text-align: center;
  text-transform: uppercase;
}

pre { background: #0b1128; color: #d5e2ff; padding: 0.65rem; border-radius: 8px; overflow: auto; max-height: 220px; }
#drafts { padding-left: 1rem; }

@media (max-width: 1280px) {
  .layout { grid-template-columns: 1fr; }
  .controls { max-height: none; overflow: visible; }
  .preview-wrap { position: static; }
  .grid3 { grid-template-columns: 1fr; }
  .shield-stat-grid { grid-template-columns: 1fr; }
}
@media (max-width: 980px) {
  .template-columns { grid-template-columns: 1fr; }
  .side-port,.side-stbd { position: static; transform: none; display: inline-flex; margin: 0.2rem; }
  .template-bottom { grid-template-columns: 1fr; }
  .footer-tags { justify-content: start; }
  .ship-art-wrap { width: 40%; }
}

.maneuver-preview {
  --man-label-width: 54px;
  --man-col-width: 24px;
  --man-col-gap: 0.45rem;
  background: transparent;
  color: #111;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 0.78rem;
  padding: 0.25rem 0.2rem;
}
.man-row { margin-bottom: 0.15rem; font-weight: 800; }
.man-row:not(.man-top) { display: grid; grid-template-columns: var(--man-label-width) max-content; column-gap: 0.35rem; align-items: center; }
.man-top { display: flex; align-items: center; gap: 0.35rem; margin-bottom: 0.22rem; }
.rnd-circles { display: inline-flex; gap: 0.2rem; min-width: 44px; }
.rnd-circle { width: 10px; height: 10px; border-radius: 999px; border: 2px solid currentColor; box-sizing: border-box; }
.rnd-circles.green { color: #00b050; }
.rnd-circles.red { color: #ff1f1f; }
.man-values { display: inline-grid; grid-template-columns: repeat(7, var(--man-col-width)); column-gap: var(--man-col-gap); justify-content: start; align-items: center; }
.man-values b { width: var(--man-col-width); text-align: center; font-size: 1.05rem; line-height: 1; font-variant-numeric: tabular-nums; }
.dmg-stop {
  width: 12px;
  height: 12px;
  border: 2px solid #111;
  box-sizing: border-box;
  display: inline-block;
  justify-self: center;
  align-self: center;
}
.dmg-stop.is-inactive { visibility: hidden; }
